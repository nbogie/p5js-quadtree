"use strict";
var Particle = (function () {
    function Particle(x, y) {
        this.pos = createVector(x, y);
    }
    Particle.prototype.draw = function () {
        stroke("white");
        strokeWeight(1);
        point(this.pos.x, this.pos.y);
    };
    Particle.randomOnScreen = function () {
        return new Particle(random(width), random(height));
    };
    Particle.perlinRandomOnScreen = function (ix) {
        var x = width * noise(ix + frameCount / 100);
        var y = height * noise(7 * ix + frameCount / 123);
        return new Particle(x, y);
    };
    return Particle;
}());
var QuadTree = (function () {
    function QuadTree(center, w, h) {
        this.myID = QuadTree.staticQTCounter++;
        this.rectangle = new Rectangle(center.x, center.y, w, h);
        this.directlyContainedPoints = [];
        this.capacity = 20;
    }
    QuadTree.build = function (cx, cy, w, h, gPoints) {
        var t = new QuadTree(createVector(cx, cy), w, h);
        gPoints.forEach(function (p) { return t.insert(p); });
        return t;
    };
    QuadTree.prototype.insert = function (p) {
        if (!this.fallsWithin(p)) {
            return false;
        }
        if (this.directlyContainedPoints.length < this.capacity) {
            this.directlyContainedPoints.push(p);
            return true;
        }
        else {
            if (!this.isSubdivided()) {
                this.subdivide();
            }
            if (this.ne.insert(p)) {
                return true;
            }
            if (this.nw.insert(p)) {
                return true;
            }
            if (this.se.insert(p)) {
                return true;
            }
            if (this.sw.insert(p)) {
                return true;
            }
            throw new Error("Should be unreachable.  All subquads reject point insertion.");
        }
    };
    QuadTree.prototype.subdivide = function () {
        var cx = this.rectangle.cx;
        var cy = this.rectangle.cy;
        var qW = this.rectangle.w / 4;
        var qH = this.rectangle.h / 4;
        var hW = qW * 2;
        var hH = qH * 2;
        this.ne = new QuadTree(cv(cx + qW, cy - qH), hW, hH);
        this.nw = new QuadTree(cv(cx - qW, cy - qH), hW, hH);
        this.se = new QuadTree(cv(cx + qW, cy + qH), hW, hH);
        this.sw = new QuadTree(cv(cx - qW, cy + qH), hW, hH);
    };
    QuadTree.prototype.fallsWithin = function (p) {
        return this.rectangle.fallsWithin(p);
    };
    QuadTree.prototype.isSubdivided = function () {
        return this.ne !== undefined;
    };
    QuadTree.prototype.query = function (queryRectangle, results) {
        if (results == undefined) {
            results = [];
        }
        if (this.rectangle.overlaps(queryRectangle)) {
            results.push.apply(results, this.directlyContainedPoints.filter(function (p) {
                return queryRectangle.fallsWithin(p);
            }));
            if (this.isSubdivided()) {
                for (var _i = 0, _a = [this.ne, this.nw, this.se, this.sw]; _i < _a.length; _i++) {
                    var subtree = _a[_i];
                    subtree.query(queryRectangle, results);
                }
            }
        }
        return results;
    };
    QuadTree.staticQTCounter = 0;
    return QuadTree;
}());
var cv = function (x, y) { return createVector(x, y); };
function drawQuadTreeForP5(tree) {
    stroke("yellow");
    strokeWeight(0.3);
    noFill();
    rectMode(CENTER);
    rect(tree.rectangle.cx, tree.rectangle.cy, tree.rectangle.w, tree.rectangle.h);
    noStroke();
    fill("white");
    textSize(10);
    text(tree.myID, tree.rectangle.cx, tree.rectangle.cy);
    if (tree.isSubdivided()) {
        for (var _i = 0, _a = [tree.ne, tree.nw, tree.se, tree.sw]; _i < _a.length; _i++) {
            var subtree = _a[_i];
            drawQuadTreeForP5(subtree);
        }
    }
}
var Rectangle = (function () {
    function Rectangle(cx, cy, w, h) {
        this.cx = cx;
        this.cy = cy;
        this.w = w;
        this.h = h;
        this.t = this.cy - h / 2;
        this.b = this.cy + h / 2;
        this.l = this.cx - w / 2;
        this.r = this.cx + w / 2;
    }
    Rectangle.prototype.fallsWithin = function (p) {
        return (p.pos.x >= this.l &&
            p.pos.x <= this.r &&
            p.pos.y >= this.t &&
            p.pos.y <= this.b);
    };
    Rectangle.prototype.overlaps = function (r2) {
        return (this.r >= r2.l &&
            this.l <= r2.r &&
            this.t <= r2.b &&
            this.b >= r2.t);
    };
    return Rectangle;
}());
function assertTrue(assertion, text) {
    if (!assertion) {
        throw new Error("AssertionError: Expected true, got false: " + text);
    }
}
function assertFalse(assertion, text) {
    if (assertion) {
        throw new Error("AssertionError: Expected false, got true: " + text);
    }
}
function assertFallsWithin(p, t) {
    assertTrue(t.fallsWithin(p), "falls within? " + p.pos);
}
function assertNotFallsWithin(p, t) {
    assertFalse(t.fallsWithin(p), "falls within? " + p.pos);
}
function testQTree() {
    function mp(x, y) {
        return new Particle(x, y);
    }
    var t = new QuadTree(createVector(200, 300), 50, 40);
    assertNotFallsWithin(mp(0, 100), t);
    assertNotFallsWithin(mp(251, 300), t);
    assertNotFallsWithin(mp(149, 300), t);
    assertFallsWithin(mp(176, 281), t);
    assertNotFallsWithin(mp(174, 281), t);
    assertTrue(t.insert(mp(180, 290)), "accept point");
    assertTrue(t.insert(mp(201, 301)), "accept point");
    var r1 = new Rectangle(920, 780, 140, 120);
    var r2 = new Rectangle(918, 720, 100, 140);
    debugger;
    assertTrue(r1.overlaps(r2), "should overlap");
}
function randomScreenPosition() {
    return createVector(random(width), random(height));
}
function centerScreenPos() {
    return createVector(width / 2, height / 2);
}
function randomInt(min, max) {
    return round(random(min, max));
}
function translateToVec(pos) {
    translate(pos.x, pos.y);
}
function minBy(list, fn) {
    if (list.length < 0) {
        return undefined;
    }
    var recordItem = list[0];
    var recordWeight = fn(list[0]);
    for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {
        var item = list_1[_i];
        var weight = fn(item);
        if (weight > recordWeight) {
            recordWeight = weight;
            recordItem = item;
        }
    }
    return recordItem;
}
function repeat(num, fn) {
    for (var i = 0; i < num; i++) {
        fn(i);
    }
}
function randomBoolean() {
    return Math.random() > 0.5;
}
function mousePosAsVector() {
    return createVector(mouseX, mouseY);
}
function timeIt(fn) {
    var a = millis();
    fn();
    return millis() - a;
}
var gPoints;
var qtree;
var gQueryRectangle;
var isGridOn = false;
var isDrawAllPoints = true;
var isDrawQueryResults = true;
function toggleDrawAllPoints() {
    isDrawAllPoints = !isDrawAllPoints;
    return isDrawAllPoints;
}
function toggleDrawQueryResults() {
    isDrawQueryResults = !isDrawQueryResults;
    return isDrawQueryResults;
}
function setup() {
    createCanvas(windowWidth, windowHeight);
    gPoints = [];
}
function mouseDragged() {
    var p = new Particle(mouseX, mouseY);
    gPoints.push(p);
}
function update() {
    gQueryRectangle = new Rectangle(mouseX, mouseY, 100, 100);
    QuadTree.staticQTCounter = 0;
    gTimings.timeToBuild = timeIt(function () {
        qtree = QuadTree.build(width / 2, height / 2, width, height, gPoints);
    });
    gTimings.timeToQuery = timeIt(function () { return (gQueryResults = qtree.query(gQueryRectangle)); });
    gTimings.timeToLocateNaively = timeIt(function () {
        return gPoints.filter(function (p) { return dist(p.pos.x, p.pos.y, mouseX, mouseY) < 100; });
    });
}
function draw() {
    gTimings.update = timeIt(function () { return update(); });
    gTimings.drawOnly = timeIt(function () { return drawOnly(); });
}
function drawOnly() {
    background("black");
    if (isGridOn) {
        drawDebugGrid();
    }
    drawQuadTreeForP5(qtree);
    if (isDrawAllPoints) {
        stroke("white");
        strokeWeight(2);
        for (var _i = 0, gPoints_1 = gPoints; _i < gPoints_1.length; _i++) {
            var p = gPoints_1[_i];
            point(p.pos.x, p.pos.y);
        }
    }
    rectMode(CENTER);
    noFill();
    stroke("orange");
    strokeWeight(0.3);
    rect(gQueryRectangle.cx, gQueryRectangle.cy, gQueryRectangle.w, gQueryRectangle.h);
    if (isDrawQueryResults) {
        strokeWeight(7);
        stroke("red");
        for (var _a = 0, gQueryResults_1 = gQueryResults; _a < gQueryResults_1.length; _a++) {
            var p = gQueryResults_1[_a];
            point(p.pos.x, p.pos.y);
        }
    }
    showDebugText(50, height - 400, [
        "FPS: " + frameRate().toFixed(2),
        "points from query: " + gQueryResults.length,
        "total points: " + gPoints.length,
        "update() (ms): " + gTimings.update.toFixed(2),
        "drawOnly() (not update) (ms): " + gTimings.drawOnly.toFixed(2),
        "query time (ms): " + gTimings.timeToQuery.toFixed(2),
        "Rebuild time (ms): " + gTimings.timeToBuild.toFixed(0),
        "Naive query (ms):" + gTimings.timeToLocateNaively.toFixed(2)
    ]);
    showDebugText(width / 2, height - 400, [
        "d - toggle Draw of all points",
        "q - toggle draw of Query points",
        "p - (re)Populate *many* points"
    ]);
}
var gTimings = {
    timeToBuild: 0,
    timeToQuery: 0,
    update: 0,
    drawOnly: 0,
    timeToLocateNaively: 0
};
var gQueryResults;
function showDebugText(x, y, lines) {
    var lineHeight = 40;
    textSize(20);
    fill("gray");
    stroke("whitesmoke");
    rectMode(CORNER);
    rect(x - 30, y - 30, width - 60, lines.length * lineHeight + 60);
    noStroke();
    fill("black");
    push();
    translate(x, y);
    lines.forEach(function (line, ix) {
        translate(0, lineHeight);
        text(line, 0, 0);
    });
    pop();
}
function drawDebugGrid() {
    noStroke();
    fill("gray");
    textSize(8);
    for (var x = 0; x < width; x += 50) {
        for (var y = 0; y < height; y += 50) {
            text(x + "," + y, x, y);
        }
    }
}
function keyPressed() {
    if (key == "d") {
        toggleDrawAllPoints();
    }
    if (key == "q") {
        toggleDrawQueryResults();
    }
    if (key == "p") {
        populateTreeRandomly();
    }
}
function populateTreeRandomly() {
    gPoints.length = 0;
    repeat(10000, function (ix) { return gPoints.push(Particle.perlinRandomOnScreen(ix)); });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLi9qcy8iLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiUGFydGljbGUudHMiLCJRdWFkVHJlZS50cyIsIlJlY3RhbmdsZS50cyIsIlRlc3RpbmdRdWFkVHJlZS50cyIsIlV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQztBQ0FiO0lBT0Usa0JBQVksQ0FBUyxFQUFFLENBQVM7UUFDOUIsSUFBSSxDQUFDLEdBQUcsR0FBRyxZQUFZLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFQRCx1QkFBSSxHQUFKO1FBQ0UsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2hCLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoQixLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBSU0sdUJBQWMsR0FBckI7UUFDRSxPQUFPLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBQ00sNkJBQW9CLEdBQTNCLFVBQTRCLEVBQVU7UUFDcEMsSUFBSSxDQUFDLEdBQUcsS0FBSyxHQUFHLEtBQUssQ0FBQyxFQUFFLEdBQUcsVUFBVSxHQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQzdDLElBQUksQ0FBQyxHQUFHLE1BQU0sR0FBRyxLQUFLLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxVQUFVLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDbEQsT0FBTyxJQUFJLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUNILGVBQUM7QUFBRCxDQUFDLEFBbEJELElBa0JDO0FDakJEO0lBd0VFLGtCQUFZLE1BQWlCLEVBQUUsQ0FBUyxFQUFFLENBQVM7UUFD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QUFDLEVBQS9DLENBQStDLENBQUMsQ0FBQztBQUN2RSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG4vL3A1LmRpc2FibGVGcmllbmRseUVycm9ycyA9IHRydWU7XG5cbi8vQ3JlZGl0czogdXNlcyBwb2ludC1yZWN0YW5nbGUgYW5kIHJlY3RhbmdsZS1yZWN0YW5nbGUgY29sbGlzaW9uIG1hdGggZnJvbTpcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ibW9yZW4vcDUuY29sbGlkZTJEL2Jsb2IvbWFzdGVyL3A1LmNvbGxpZGUyZC5qc1xuLy8gbGljZW5zZTogaHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9cblxuaW50ZXJmYWNlIFBvaW50IHtcbiAgcG9zOiBwNS5WZWN0b3I7XG59XG5cbmxldCBnUG9pbnRzOiBQYXJ0aWNsZVtdO1xuXG5sZXQgcXRyZWU6IFF1YWRUcmVlO1xubGV0IGdRdWVyeVJlY3RhbmdsZTogUmVjdGFuZ2xlO1xubGV0IGlzR3JpZE9uID0gZmFsc2U7XG5sZXQgaXNEcmF3QWxsUG9pbnRzID0gdHJ1ZTtcbmxldCBpc0RyYXdRdWVyeVJlc3VsdHMgPSB0cnVlO1xuXG5mdW5jdGlvbiB0b2dnbGVEcmF3QWxsUG9pbnRzKCk6IGJvb2xlYW4ge1xuICBpc0RyYXdBbGxQb2ludHMgPSAhaXNEcmF3QWxsUG9pbnRzO1xuICByZXR1cm4gaXNEcmF3QWxsUG9pbnRzO1xufVxuZnVuY3Rpb24gdG9nZ2xlRHJhd1F1ZXJ5UmVzdWx0cygpOiBib29sZWFuIHtcbiAgaXNEcmF3UXVlcnlSZXN1bHRzID0gIWlzRHJhd1F1ZXJ5UmVzdWx0cztcbiAgcmV0dXJuIGlzRHJhd1F1ZXJ5UmVzdWx0cztcbn1cblxuZnVuY3Rpb24gc2V0dXAoKSB7XG4gIGNyZWF0ZUNhbnZhcyh3aW5kb3dXaWR0aCwgd2luZG93SGVpZ2h0KTtcbiAgZ1BvaW50cyA9IFtdO1xufVxuXG5mdW5jdGlvbiBtb3VzZURyYWdnZWQoKSB7XG4gIGxldCBwID0gbmV3IFBhcnRpY2xlKG1vdXNlWCwgbW91c2VZKTtcbiAgZ1BvaW50cy5wdXNoKHApO1xufVxuXG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gIGdRdWVyeVJlY3RhbmdsZSA9IG5ldyBSZWN0YW5nbGUobW91c2VYLCBtb3VzZVksIDEwMCwgMTAwKTtcbiAgUXVhZFRyZWUuc3RhdGljUVRDb3VudGVyID0gMDtcbiAgZ1RpbWluZ3MudGltZVRvQnVpbGQgPSB0aW1lSXQoKCkgPT4ge1xuICAgIHF0cmVlID0gUXVhZFRyZWUuYnVpbGQod2lkdGggLyAyLCBoZWlnaHQgLyAyLCB3aWR0aCwgaGVpZ2h0LCBnUG9pbnRzKTtcbiAgfSk7XG4gIC8vbWFrZSB0aGUgcXVlcnkgYW5kIGhpZ2hsaWdodCB0aGUgcG9pbnRzIGl0IHJldHVybnNcbiAgZ1RpbWluZ3MudGltZVRvUXVlcnkgPSB0aW1lSXQoXG4gICAgKCkgPT4gKGdRdWVyeVJlc3VsdHMgPSBxdHJlZS5xdWVyeShnUXVlcnlSZWN0YW5nbGUpKVxuICApO1xuICBnVGltaW5ncy50aW1lVG9Mb2NhdGVOYWl2ZWx5ID0gdGltZUl0KCgpID0+XG4gICAgZ1BvaW50cy5maWx0ZXIocCA9PiBkaXN0KHAucG9zLngsIHAucG9zLnksIG1vdXNlWCwgbW91c2VZKSA8IDEwMClcbiAgKTtcbn1cblxuZnVuY3Rpb24gZHJhdygpIHtcbiAgZ1RpbWluZ3MudXBkYXRlID0gdGltZUl0KCgpID0+IHVwZGF0ZSgpKTtcbiAgZ1RpbWluZ3MuZHJhd09ubHkgPSB0aW1lSXQoKCkgPT4gZHJhd09ubHkoKSk7XG59XG5mdW5jdGlvbiBkcmF3T25seSgpIHtcbiAgYmFja2dyb3VuZChcImJsYWNrXCIpO1xuICBpZiAoaXNHcmlkT24pIHtcbiAgICBkcmF3RGVidWdHcmlkKCk7XG4gIH1cbiAgZHJhd1F1YWRUcmVlRm9yUDUocXRyZWUpO1xuXG4gIGlmIChpc0RyYXdBbGxQb2ludHMpIHtcbiAgICAvL2RyYXcgQUxMIHRoZSBwb2ludHMgaW4gdGhlIGRlbW9cbiAgICBzdHJva2UoXCJ3aGl0ZVwiKTtcbiAgICBzdHJva2VXZWlnaHQoMik7XG5cbiAgICBmb3IgKGxldCBwIG9mIGdQb2ludHMpIHtcbiAgICAgIHBvaW50KHAucG9zLngsIHAucG9zLnkpO1xuICAgIH1cbiAgfVxuXG4gIC8vZHJhdyB0aGUgcXVlcnkgcmVjdGFuZ2xlIChmb2xsb3dzIHRoZSBtb3VzZSlcbiAgcmVjdE1vZGUoQ0VOVEVSKTtcbiAgbm9GaWxsKCk7XG4gIHN0cm9rZShcIm9yYW5nZVwiKTtcbiAgc3Ryb2tlV2VpZ2h0KDAuMyk7XG4gIHJlY3QoXG4gICAgZ1F1ZXJ5UmVjdGFuZ2xlLmN4LFxuICAgIGdRdWVyeVJlY3RhbmdsZS5jeSxcbiAgICBnUXVlcnlSZWN0YW5nbGUudyxcbiAgICBnUXVlcnlSZWN0YW5nbGUuaFxuICApO1xuXG4gIGlmIChpc0RyYXdRdWVyeVJlc3VsdHMpIHtcbiAgICBzdHJva2VXZWlnaHQoNyk7XG4gICAgc3Ryb2tlKFwicmVkXCIpO1xuICAgIGZvciAobGV0IHAgb2YgZ1F1ZXJ5UmVzdWx0cykge1xuICAgICAgcG9pbnQocC5wb3MueCwgcC5wb3MueSk7XG4gICAgfVxuICB9XG5cbiAgLy9kZWJ1Z2dpbmcgY291bnRcbiAgc2hvd0RlYnVnVGV4dCg1MCwgaGVpZ2h0IC0gNDAwLCBbXG4gICAgXCJGUFM6IFwiICsgZnJhbWVSYXRlKCkudG9GaXhlZCgyKSxcbiAgICBcInBvaW50cyBmcm9tIHF1ZXJ5OiBcIiArIGdRdWVyeVJlc3VsdHMubGVuZ3RoLFxuICAgIFwidG90YWwgcG9pbnRzOiBcIiArIGdQb2ludHMubGVuZ3RoLFxuICAgIFwidXBkYXRlKCkgKG1zKTogXCIgKyBnVGltaW5ncy51cGRhdGUudG9GaXhlZCgyKSxcbiAgICBcImRyYXdPbmx5KCkgKG5vdCB1cGRhdGUpIChtcyk6IFwiICsgZ1RpbWluZ3MuZHJhd09ubHkudG9GaXhlZCgyKSxcbiAgICBcInF1ZXJ5IHRpbWUgKG1zKTogXCIgKyBnVGltaW5ncy50aW1lVG9RdWVyeS50b0ZpeGVkKDIpLFxuICAgIFwiUmVidWlsZCB0aW1lIChtcyk6IFwiICsgZ1RpbWluZ3MudGltZVRvQnVpbGQudG9GaXhlZCgwKSxcbiAgICBcIk5haXZlIHF1ZXJ5IChtcyk6XCIgKyBnVGltaW5ncy50aW1lVG9Mb2NhdGVOYWl2ZWx5LnRvRml4ZWQoMilcbiAgXSk7XG4gIHNob3dEZWJ1Z1RleHQod2lkdGggLyAyLCBoZWlnaHQgLSA0MDAsIFtcbiAgICBcImQgLSB0b2dnbGUgRHJhdyBvZiBhbGwgcG9pbnRzXCIsXG4gICAgXCJxIC0gdG9nZ2xlIGRyYXcgb2YgUXVlcnkgcG9pbnRzXCIsXG4gICAgXCJwIC0gKHJlKVBvcHVsYXRlICptYW55KiBwb2ludHNcIlxuICBdKTtcbn1cblxubGV0IGdUaW1pbmdzID0ge1xuICB0aW1lVG9CdWlsZDogMCxcbiAgdGltZVRvUXVlcnk6IDAsXG4gIHVwZGF0ZTogMCxcbiAgZHJhd09ubHk6IDAsXG4gIHRpbWVUb0xvY2F0ZU5haXZlbHk6IDBcbn07XG5sZXQgZ1F1ZXJ5UmVzdWx0czogUG9pbnRbXTtcblxuZnVuY3Rpb24gc2hvd0RlYnVnVGV4dCh4OiBudW1iZXIsIHk6IG51bWJlciwgbGluZXM6IHN0cmluZ1tdKSB7XG4gIGNvbnN0IGxpbmVIZWlnaHQgPSA0MDtcbiAgdGV4dFNpemUoMjApO1xuICBmaWxsKFwiZ3JheVwiKTtcbiAgc3Ryb2tlKFwid2hpdGVzbW9rZVwiKTtcbiAgcmVjdE1vZGUoQ09STkVSKTtcbiAgcmVjdCh4IC0gMzAsIHkgLSAzMCwgd2lkdGggLSA2MCwgbGluZXMubGVuZ3RoICogbGluZUhlaWdodCArIDYwKTtcbiAgbm9TdHJva2UoKTtcbiAgZmlsbChcImJsYWNrXCIpO1xuXG4gIHB1c2goKTtcbiAgdHJhbnNsYXRlKHgsIHkpO1xuICBsaW5lcy5mb3JFYWNoKChsaW5lOiBzdHJpbmcsIGl4OiBudW1iZXIpID0+IHtcbiAgICB0cmFuc2xhdGUoMCwgbGluZUhlaWdodCk7XG4gICAgdGV4dChsaW5lLCAwLCAwKTtcbiAgfSk7XG4gIHBvcCgpO1xufVxuZnVuY3Rpb24gZHJhd0RlYnVnR3JpZCgpIHtcbiAgbm9TdHJva2UoKTtcbiAgZmlsbChcImdyYXlcIik7XG4gIHRleHRTaXplKDgpO1xuICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyB4ICs9IDUwKSB7XG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7IHkgKz0gNTApIHtcbiAgICAgIHRleHQoYCR7eH0sJHt5fWAsIHgsIHkpO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24ga2V5UHJlc3NlZCgpIHtcbiAgaWYgKGtleSA9PSBcImRcIikge1xuICAgIHRvZ2dsZURyYXdBbGxQb2ludHMoKTtcbiAgfVxuICBpZiAoa2V5ID09IFwicVwiKSB7XG4gICAgdG9nZ2xlRHJhd1F1ZXJ5UmVzdWx0cygpO1xuICB9XG4gIGlmIChrZXkgPT0gXCJwXCIpIHtcbiAgICBwb3B1bGF0ZVRyZWVSYW5kb21seSgpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHBvcHVsYXRlVHJlZVJhbmRvbWx5KCk6IHZvaWQge1xuICBnUG9pbnRzLmxlbmd0aCA9IDA7XG4gIHJlcGVhdCgxMDAwMCwgaXggPT4gZ1BvaW50cy5wdXNoKFBhcnRpY2xlLnBlcmxpblJhbmRvbU9uU2NyZWVuKGl4KSkpO1xufVxuIiwiY2xhc3MgUGFydGljbGUge1xuICBwb3M6IHA1LlZlY3RvcjtcbiAgZHJhdygpOiB2b2lkIHtcbiAgICBzdHJva2UoXCJ3aGl0ZVwiKTtcbiAgICBzdHJva2VXZWlnaHQoMSk7XG4gICAgcG9pbnQodGhpcy5wb3MueCwgdGhpcy5wb3MueSk7XG4gIH1cbiAgY29uc3RydWN0b3IoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICB0aGlzLnBvcyA9IGNyZWF0ZVZlY3Rvcih4LCB5KTtcbiAgfVxuICBzdGF0aWMgcmFuZG9tT25TY3JlZW4oKTogUGFydGljbGUge1xuICAgIHJldHVybiBuZXcgUGFydGljbGUocmFuZG9tKHdpZHRoKSwgcmFuZG9tKGhlaWdodCkpO1xuICB9XG4gIHN0YXRpYyBwZXJsaW5SYW5kb21PblNjcmVlbihpeDogbnVtYmVyKTogUGFydGljbGUge1xuICAgIGxldCB4ID0gd2lkdGggKiBub2lzZShpeCArIGZyYW1lQ291bnQgLyAxMDApO1xuICAgIGxldCB5ID0gaGVpZ2h0ICogbm9pc2UoNyAqIGl4ICsgZnJhbWVDb3VudCAvIDEyMyk7XG4gICAgcmV0dXJuIG5ldyBQYXJ0aWNsZSh4LCB5KTtcbiAgfVxufVxuIiwiLy9UT0RPOiByZW1vdmUgcDUuVmVjdG9yIC0gaGF2ZSBubyBkZXBlbmRlbmNlIG9uIHA1XG5jbGFzcyBRdWFkVHJlZSB7XG4gIHN0YXRpYyBzdGF0aWNRVENvdW50ZXIgPSAwO1xuXG4gIHN0YXRpYyBidWlsZChcbiAgICBjeDogbnVtYmVyLFxuICAgIGN5OiBudW1iZXIsXG4gICAgdzogbnVtYmVyLFxuICAgIGg6IG51bWJlcixcbiAgICBnUG9pbnRzOiBQYXJ0aWNsZVtdXG4gICk6IFF1YWRUcmVlIHtcbiAgICBjb25zdCB0ID0gbmV3IFF1YWRUcmVlKGNyZWF0ZVZlY3RvcihjeCwgY3kpLCB3LCBoKTtcbiAgICBnUG9pbnRzLmZvckVhY2gocCA9PiB0Lmluc2VydChwKSk7XG4gICAgcmV0dXJuIHQ7XG4gIH1cbiAgaW5zZXJ0KHA6IFBvaW50KTogYm9vbGVhbiB7XG4gICAgaWYgKCF0aGlzLmZhbGxzV2l0aGluKHApKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vYWNjZXB0IGRpcmVjdGx5LCBvciBkZWxlZ2F0ZVxuICAgIGlmICh0aGlzLmRpcmVjdGx5Q29udGFpbmVkUG9pbnRzLmxlbmd0aCA8IHRoaXMuY2FwYWNpdHkpIHtcbiAgICAgIHRoaXMuZGlyZWN0bHlDb250YWluZWRQb2ludHMucHVzaChwKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIXRoaXMuaXNTdWJkaXZpZGVkKCkpIHtcbiAgICAgICAgdGhpcy5zdWJkaXZpZGUoKTtcbiAgICAgIH1cbiAgICAgIC8vZGVsZWdhdGVcbiAgICAgIGlmICh0aGlzLm5lLmluc2VydChwKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm53Lmluc2VydChwKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnNlLmluc2VydChwKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnN3Lmluc2VydChwKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJTaG91bGQgYmUgdW5yZWFjaGFibGUuICBBbGwgc3VicXVhZHMgcmVqZWN0IHBvaW50IGluc2VydGlvbi5cIlxuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgc3ViZGl2aWRlKCkge1xuICAgIGNvbnN0IGN4ID0gdGhpcy5yZWN0YW5nbGUuY3g7XG4gICAgY29uc3QgY3kgPSB0aGlzLnJlY3RhbmdsZS5jeTtcbiAgICBjb25zdCBxVyA9IHRoaXMucmVjdGFuZ2xlLncgLyA0OyAvL3F1YXJ0ZXIgd2lkdGgsIHF1YXJ0ZXIgaGVpZ2h0XG4gICAgY29uc3QgcUggPSB0aGlzLnJlY3RhbmdsZS5oIC8gNDtcbiAgICBjb25zdCBoVyA9IHFXICogMjsgLy8gaGFsZiB3aWR0aCwgaGFsZiBoZWlnaHRcbiAgICBjb25zdCBoSCA9IHFIICogMjtcblxuICAgIHRoaXMubmUgPSBuZXcgUXVhZFRyZWUoY3YoY3ggKyBxVywgY3kgLSBxSCksIGhXLCBoSCk7XG4gICAgdGhpcy5udyA9IG5ldyBRdWFkVHJlZShjdihjeCAtIHFXLCBjeSAtIHFIKSwgaFcsIGhIKTtcbiAgICB0aGlzLnNlID0gbmV3IFF1YWRUcmVlKGN2KGN4ICsgcVcsIGN5ICsgcUgpLCBoVywgaEgpO1xuICAgIHRoaXMuc3cgPSBuZXcgUXVhZFRyZWUoY3YoY3ggLSBxVywgY3kgKyBxSCksIGhXLCBoSCk7XG4gIH1cblxuICAvL21vZGlmaWVkIGZyb20gcDUuY29sbGlkZTJkLmpzIGh0dHBzOi8vZ2l0aHViLmNvbS9ibW9yZW4vcDUuY29sbGlkZTJEL2Jsb2IvbWFzdGVyL3A1LmNvbGxpZGUyZC5qc1xuICBmYWxsc1dpdGhpbihwOiBQb2ludCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnJlY3RhbmdsZS5mYWxsc1dpdGhpbihwKTtcbiAgfVxuXG4gIGRpcmVjdGx5Q29udGFpbmVkUG9pbnRzOiBQb2ludFtdO1xuICBjYXBhY2l0eTogbnVtYmVyO1xuICBuZT86IFF1YWRUcmVlO1xuICBzZT86IFF1YWRUcmVlO1xuICBudz86IFF1YWRUcmVlO1xuICBzdz86IFF1YWRUcmVlO1xuXG4gIHJlY3RhbmdsZTogUmVjdGFuZ2xlO1xuICBteUlEOiBudW1iZXI7XG4gIGNvbnN0cnVjdG9yKGNlbnRlcjogcDUuVmVjdG9yLCB3OiBudW1iZXIsIGg6IG51bWJlcikge1xuICAgIHRoaXMubXlJRCA9IFF1YWRUcmVlLnN0YXRpY1FUQ291bnRlcisrO1xuICAgIHRoaXMucmVjdGFuZ2xlID0gbmV3IFJlY3RhbmdsZShjZW50ZXIueCwgY2VudGVyLnksIHcsIGgpO1xuICAgIHRoaXMuZGlyZWN0bHlDb250YWluZWRQb2ludHMgPSBbXTtcbiAgICB0aGlzLmNhcGFjaXR5ID0gMjA7XG4gIH1cbiAgaXNTdWJkaXZpZGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLm5lICE9PSB1bmRlZmluZWQ7XG4gIH1cblxuICBxdWVyeShxdWVyeVJlY3RhbmdsZTogUmVjdGFuZ2xlLCByZXN1bHRzPzogUG9pbnRbXSk6IFBvaW50W10ge1xuICAgIGlmIChyZXN1bHRzID09IHVuZGVmaW5lZCkge1xuICAgICAgcmVzdWx0cyA9IFtdO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJlY3RhbmdsZS5vdmVybGFwcyhxdWVyeVJlY3RhbmdsZSkpIHtcbiAgICAgIHJlc3VsdHMucHVzaChcbiAgICAgICAgLi4udGhpcy5kaXJlY3RseUNvbnRhaW5lZFBvaW50cy5maWx0ZXIocCA9PlxuICAgICAgICAgIHF1ZXJ5UmVjdGFuZ2xlLmZhbGxzV2l0aGluKHApXG4gICAgICAgIClcbiAgICAgICk7XG5cbiAgICAgIGlmICh0aGlzLmlzU3ViZGl2aWRlZCgpKSB7XG4gICAgICAgIGZvciAobGV0IHN1YnRyZWUgb2YgW3RoaXMubmUsIHRoaXMubncsIHRoaXMuc2UsIHRoaXMuc3ddKSB7XG4gICAgICAgICAgc3VidHJlZS5xdWVyeShxdWVyeVJlY3RhbmdsZSwgcmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxufVxuY29uc3QgY3YgPSAoeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IGNyZWF0ZVZlY3Rvcih4LCB5KTtcblxuLy9UT0RPOiB0aGlzIHJlcXVpcmVzIHA1LiAga2VlcCBzZXBhcmF0ZSBmcm9tIGxpYnJhcnktaW5kZXBlbmRlbnQgcXVhZHRyZWUgY29kZVxuZnVuY3Rpb24gZHJhd1F1YWRUcmVlRm9yUDUodHJlZTogUXVhZFRyZWUpOiB2b2lkIHtcbiAgc3Ryb2tlKFwieWVsbG93XCIpO1xuICBzdHJva2VXZWlnaHQoMC4zKTtcbiAgbm9GaWxsKCk7XG4gIHJlY3RNb2RlKENFTlRFUik7XG4gIHJlY3QoXG4gICAgdHJlZS5yZWN0YW5nbGUuY3gsXG4gICAgdHJlZS5yZWN0YW5nbGUuY3ksXG4gICAgdHJlZS5yZWN0YW5nbGUudyxcbiAgICB0cmVlLnJlY3RhbmdsZS5oXG4gICk7XG5cbiAgbm9TdHJva2UoKTtcbiAgZmlsbChcIndoaXRlXCIpO1xuICB0ZXh0U2l6ZSgxMCk7XG4gIHRleHQodHJlZS5teUlELCB0cmVlLnJlY3RhbmdsZS5jeCwgdHJlZS5yZWN0YW5nbGUuY3kpO1xuICAvL3RleHQodHJlZS5kaXJlY3RseUNvbnRhaW5lZFBvaW50cy5sZW5ndGgsIHRyZWUuY2VudGVyLngsIHRyZWUuY2VudGVyLnkpO1xuXG4gIGlmICh0cmVlLmlzU3ViZGl2aWRlZCgpKSB7XG4gICAgZm9yIChsZXQgc3VidHJlZSBvZiBbdHJlZS5uZSwgdHJlZS5udywgdHJlZS5zZSwgdHJlZS5zd10pIHtcbiAgICAgIGRyYXdRdWFkVHJlZUZvclA1KHN1YnRyZWUpO1xuICAgIH1cbiAgfVxufVxuIiwiY2xhc3MgUmVjdGFuZ2xlIHtcbiAgY3g6IG51bWJlcjtcbiAgY3k6IG51bWJlcjtcblxuICB0OiBudW1iZXI7XG4gIGI6IG51bWJlcjtcbiAgbDogbnVtYmVyO1xuICByOiBudW1iZXI7XG5cbiAgdzogbnVtYmVyO1xuICBoOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoY3g6IG51bWJlciwgY3k6IG51bWJlciwgdzogbnVtYmVyLCBoOiBudW1iZXIpIHtcbiAgICB0aGlzLmN4ID0gY3g7XG4gICAgdGhpcy5jeSA9IGN5O1xuICAgIHRoaXMudyA9IHc7XG4gICAgdGhpcy5oID0gaDtcbiAgICB0aGlzLnQgPSB0aGlzLmN5IC0gaCAvIDI7XG4gICAgdGhpcy5iID0gdGhpcy5jeSArIGggLyAyO1xuICAgIHRoaXMubCA9IHRoaXMuY3ggLSB3IC8gMjtcbiAgICB0aGlzLnIgPSB0aGlzLmN4ICsgdyAvIDI7XG4gIH1cblxuICAvL21vZGlmaWVkIGZyb20gY29sbGlkZVBvaW50UmVjdDtcbiAgLy9odHRwczovL2dpdGh1Yi5jb20vYm1vcmVuL3A1LmNvbGxpZGUyRC9ibG9iL21hc3Rlci9wNS5jb2xsaWRlMmQuanNcbiAgZmFsbHNXaXRoaW4ocDogUG9pbnQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgcC5wb3MueCA+PSB0aGlzLmwgJiYgLy8gcmlnaHQgb2YgdGhlIGxlZnQgZWRnZSBBTkRcbiAgICAgIHAucG9zLnggPD0gdGhpcy5yICYmIC8vIGxlZnQgb2YgdGhlIHJpZ2h0IGVkZ2UgQU5EXG4gICAgICBwLnBvcy55ID49IHRoaXMudCAmJiAvLyBiZWxvdyB0aGUgdG9wIEFORFxuICAgICAgcC5wb3MueSA8PSB0aGlzLmIgLy8gYWJvdmUgdGhlIGJvdHRvbVxuICAgICk7XG4gIH1cblxuICAvL21vZGlmaWVkIGZyb20gY29sbGlkZVJlY3RSZWN0O1xuICAvL2h0dHBzOi8vZ2l0aHViLmNvbS9ibW9yZW4vcDUuY29sbGlkZTJEL2Jsb2IvbWFzdGVyL3A1LmNvbGxpZGUyZC5qc1xuICBvdmVybGFwcyhyMjogUmVjdGFuZ2xlKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuciA+PSByMi5sICYmIC8vIG15IHJpZ2h0IGlzIHJpZ2h0IG9mIHlvdXIgbGVmdFxuICAgICAgdGhpcy5sIDw9IHIyLnIgJiYgLy8gbXkgbGVmdCBpcyBsZWZ0IG9mIHlvdXIgcmlnaHRcbiAgICAgIHRoaXMudCA8PSByMi5iICYmIC8vIG15IHVwcGVyIGlzIGFib3ZlIHlvdXIgbG93ZXJcbiAgICAgIHRoaXMuYiA+PSByMi50IC8vIG15IGxvd2VyIGlzIGxvd2VyIHRoYW4geW91ciB1cHBlclxuICAgICk7XG4gIH1cbn1cbiIsImZ1bmN0aW9uIGFzc2VydFRydWUoYXNzZXJ0aW9uOiBib29sZWFuLCB0ZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgaWYgKCFhc3NlcnRpb24pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJBc3NlcnRpb25FcnJvcjogRXhwZWN0ZWQgdHJ1ZSwgZ290IGZhbHNlOiBcIiArIHRleHQpO1xuICB9XG59XG5mdW5jdGlvbiBhc3NlcnRGYWxzZShhc3NlcnRpb246IGJvb2xlYW4sIHRleHQ6IHN0cmluZyk6IHZvaWQge1xuICBpZiAoYXNzZXJ0aW9uKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQXNzZXJ0aW9uRXJyb3I6IEV4cGVjdGVkIGZhbHNlLCBnb3QgdHJ1ZTogXCIgKyB0ZXh0KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhc3NlcnRGYWxsc1dpdGhpbihwOiBQb2ludCwgdDogUXVhZFRyZWUpIHtcbiAgYXNzZXJ0VHJ1ZSh0LmZhbGxzV2l0aGluKHApLCBgZmFsbHMgd2l0aGluPyAke3AucG9zfWApO1xufVxuZnVuY3Rpb24gYXNzZXJ0Tm90RmFsbHNXaXRoaW4ocDogUG9pbnQsIHQ6IFF1YWRUcmVlKSB7XG4gIGFzc2VydEZhbHNlKHQuZmFsbHNXaXRoaW4ocCksIGBmYWxscyB3aXRoaW4/ICR7cC5wb3N9YCk7XG59XG5cbmZ1bmN0aW9uIHRlc3RRVHJlZSgpOiB2b2lkIHtcbiAgZnVuY3Rpb24gbXAoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICByZXR1cm4gbmV3IFBhcnRpY2xlKHgsIHkpO1xuICB9XG4gIGNvbnN0IHQgPSBuZXcgUXVhZFRyZWUoY3JlYXRlVmVjdG9yKDIwMCwgMzAwKSwgNTAsIDQwKTtcblxuICBhc3NlcnROb3RGYWxsc1dpdGhpbihtcCgwLCAxMDApLCB0KTtcblxuICBhc3NlcnROb3RGYWxsc1dpdGhpbihtcCgyNTEsIDMwMCksIHQpO1xuICBhc3NlcnROb3RGYWxsc1dpdGhpbihtcCgxNDksIDMwMCksIHQpO1xuXG4gIGFzc2VydEZhbGxzV2l0aGluKG1wKDE3NiwgMjgxKSwgdCk7XG4gIGFzc2VydE5vdEZhbGxzV2l0aGluKG1wKDE3NCwgMjgxKSwgdCk7XG5cbiAgYXNzZXJ0VHJ1ZSh0Lmluc2VydChtcCgxODAsIDI5MCkpLCBcImFjY2VwdCBwb2ludFwiKTtcbiAgYXNzZXJ0VHJ1ZSh0Lmluc2VydChtcCgyMDEsIDMwMSkpLCBcImFjY2VwdCBwb2ludFwiKTtcblxuICBsZXQgcjEgPSBuZXcgUmVjdGFuZ2xlKDkyMCwgNzgwLCAxNDAsIDEyMCk7XG4gIGxldCByMiA9IG5ldyBSZWN0YW5nbGUoOTE4LCA3MjAsIDEwMCwgMTQwKTtcbiAgZGVidWdnZXI7XG4gIGFzc2VydFRydWUocjEub3ZlcmxhcHMocjIpLCBcInNob3VsZCBvdmVybGFwXCIpO1xufVxuIiwiZnVuY3Rpb24gcmFuZG9tU2NyZWVuUG9zaXRpb24oKTogcDUuVmVjdG9yIHtcbiAgcmV0dXJuIGNyZWF0ZVZlY3RvcihyYW5kb20od2lkdGgpLCByYW5kb20oaGVpZ2h0KSk7XG59XG5cbmZ1bmN0aW9uIGNlbnRlclNjcmVlblBvcygpOiBwNS5WZWN0b3Ige1xuICByZXR1cm4gY3JlYXRlVmVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7XG59XG5cbmZ1bmN0aW9uIHJhbmRvbUludChtaW46IG51bWJlciwgbWF4OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gcm91bmQocmFuZG9tKG1pbiwgbWF4KSk7XG59XG5cbmZ1bmN0aW9uIHRyYW5zbGF0ZVRvVmVjKHBvczogcDUuVmVjdG9yKTogdm9pZCB7XG4gIHRyYW5zbGF0ZShwb3MueCwgcG9zLnkpO1xufVxuXG4vKiogRmluZCB0aGUgbWluaW11bSBvZiB0aGUgZ2l2ZW4gbGlzdCBhZnRlciBhcHBseWluZyBmbigpIHRvIGVhY2guXG4gKiBSZXR1cm4gdGhlIG1pbmltdW0sIGZpcnN0IG1pbmltdW0sIG9yIHVuZGVmaW5lZCBpZiB0aGVyZSBhcmUgbm8gaXRlbXMuXG4gKi9cbmZ1bmN0aW9uIG1pbkJ5PFQ+KGxpc3Q6IFRbXSwgZm46IChpdGVtOiBUKSA9PiBudW1iZXIpOiBUIHtcbiAgaWYgKGxpc3QubGVuZ3RoIDwgMCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgbGV0IHJlY29yZEl0ZW0gPSBsaXN0WzBdO1xuICBsZXQgcmVjb3JkV2VpZ2h0ID0gZm4obGlzdFswXSk7XG4gIGZvciAobGV0IGl0ZW0gb2YgbGlzdCkge1xuICAgIGNvbnN0IHdlaWdodCA9IGZuKGl0ZW0pO1xuICAgIGlmICh3ZWlnaHQgPiByZWNvcmRXZWlnaHQpIHtcbiAgICAgIHJlY29yZFdlaWdodCA9IHdlaWdodDtcbiAgICAgIHJlY29yZEl0ZW0gPSBpdGVtO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVjb3JkSXRlbTtcbn1cblxuLyoqIFJlcGVhdGVkbHkgY2FsbCB0aGUgZ2l2ZW4gZnVuY3Rpb24gZm4sIG51bSB0aW1lcywgdGhyb3dpbmcgYW55IG91dHB1dCBhd2F5LiAqL1xuZnVuY3Rpb24gcmVwZWF0KG51bTogbnVtYmVyLCBmbjogKGl4OiBudW1iZXIpID0+IHZvaWQpIHtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW07IGkrKykge1xuICAgIGZuKGkpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHJhbmRvbUJvb2xlYW4oKTogYm9vbGVhbiB7XG4gIHJldHVybiBNYXRoLnJhbmRvbSgpID4gMC41O1xufVxuXG5mdW5jdGlvbiBtb3VzZVBvc0FzVmVjdG9yKCk6IHA1LlZlY3RvciB7XG4gIHJldHVybiBjcmVhdGVWZWN0b3IobW91c2VYLCBtb3VzZVkpO1xufVxuXG5mdW5jdGlvbiB0aW1lSXQoZm46ICgpID0+IHZvaWQpIHtcbiAgY29uc3QgYSA9IG1pbGxpcygpO1xuICBmbigpO1xuICByZXR1cm4gbWlsbGlzKCkgLSBhO1xufVxuIl19