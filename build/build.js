"use strict";
var Particle = (function () {
    function Particle(x, y) {
        this.pos = createVector(x, y);
    }
    Particle.prototype.draw = function () {
        stroke("white");
        strokeWeight(1);
        point(this.pos.x, this.pos.y);
    };
    Particle.randomOnScreen = function () {
        return new Particle(random(width), random(height));
    };
    Particle.perlinRandomOnScreen = function (ix) {
        var x = width * noise(ix + frameCount / 100);
        var y = height * noise(7 * ix + frameCount / 123);
        return new Particle(x, y);
    };
    return Particle;
}());
var gQTCounter = 0;
var QuadTree = (function () {
    function QuadTree(center, w, h) {
        this.myID = gQTCounter++;
        this.rectangle = new Rectangle(center.x, center.y, w, h);
        this.directlyContainedPoints = [];
        this.capacity = 20;
    }
    QuadTree.build = function (cx, cy, w, h, gPoints) {
        var t = new QuadTree(createVector(cx, cy), w, h);
        gPoints.forEach(function (p) { return t.insert(p); });
        return t;
    };
    QuadTree.prototype.insert = function (p) {
        if (!this.fallsWithin(p)) {
            return false;
        }
        if (this.directlyContainedPoints.length < this.capacity) {
            this.directlyContainedPoints.push(p);
            return true;
        }
        else {
            if (!this.isSubdivided()) {
                this.subdivide();
            }
            if (this.ne.insert(p)) {
                return true;
            }
            if (this.nw.insert(p)) {
                return true;
            }
            if (this.se.insert(p)) {
                return true;
            }
            if (this.sw.insert(p)) {
                return true;
            }
            throw new Error("Should be unreachable.  All subquads reject point insertion.");
        }
    };
    QuadTree.prototype.subdivide = function () {
        var cx = this.rectangle.cx;
        var cy = this.rectangle.cy;
        var qW = this.rectangle.w / 4;
        var qH = this.rectangle.h / 4;
        var hW = qW * 2;
        var hH = qH * 2;
        this.ne = new QuadTree(cv(cx + qW, cy - qH), hW, hH);
        this.nw = new QuadTree(cv(cx - qW, cy - qH), hW, hH);
        this.se = new QuadTree(cv(cx + qW, cy + qH), hW, hH);
        this.sw = new QuadTree(cv(cx - qW, cy + qH), hW, hH);
    };
    QuadTree.prototype.fallsWithin = function (p) {
        return this.rectangle.fallsWithin(p);
    };
    QuadTree.prototype.isSubdivided = function () {
        return this.ne !== undefined;
    };
    QuadTree.prototype.query = function (queryRectangle, results) {
        if (results == undefined) {
            results = [];
        }
        if (this.rectangle.overlaps(queryRectangle)) {
            results.push.apply(results, this.directlyContainedPoints.filter(function (p) {
                return queryRectangle.fallsWithin(p);
            }));
            if (this.isSubdivided()) {
                for (var _i = 0, _a = [this.ne, this.nw, this.se, this.sw]; _i < _a.length; _i++) {
                    var subtree = _a[_i];
                    subtree.query(queryRectangle, results);
                }
            }
        }
        return results;
    };
    return QuadTree;
}());
var cv = function (x, y) { return createVector(x, y); };
function drawQuadTreeForP5(tree) {
    stroke("yellow");
    strokeWeight(0.3);
    noFill();
    rectMode(CENTER);
    rect(tree.rectangle.cx, tree.rectangle.cy, tree.rectangle.w, tree.rectangle.h);
    noStroke();
    fill("white");
    textSize(10);
    text(tree.myID, tree.rectangle.cx, tree.rectangle.cy);
    if (tree.isSubdivided()) {
        for (var _i = 0, _a = [tree.ne, tree.nw, tree.se, tree.sw]; _i < _a.length; _i++) {
            var subtree = _a[_i];
            drawQuadTreeForP5(subtree);
        }
    }
}
var Rectangle = (function () {
    function Rectangle(cx, cy, w, h) {
        this.cx = cx;
        this.cy = cy;
        this.w = w;
        this.h = h;
        this.t = this.cy - h / 2;
        this.b = this.cy + h / 2;
        this.l = this.cx - w / 2;
        this.r = this.cx + w / 2;
    }
    Rectangle.prototype.fallsWithin = function (p) {
        return (p.pos.x >= this.l &&
            p.pos.x <= this.r &&
            p.pos.y >= this.t &&
            p.pos.y <= this.b);
    };
    Rectangle.prototype.overlaps = function (r2) {
        return (this.r >= r2.l &&
            this.l <= r2.r &&
            this.t <= r2.b &&
            this.b >= r2.t);
    };
    return Rectangle;
}());
function assertTrue(assertion, text) {
    if (!assertion) {
        throw new Error("AssertionError: Expected true, got false: " + text);
    }
}
function assertFalse(assertion, text) {
    if (assertion) {
        throw new Error("AssertionError: Expected false, got true: " + text);
    }
}
function assertFallsWithin(p, t) {
    assertTrue(t.fallsWithin(p), "falls within? " + p.pos);
}
function assertNotFallsWithin(p, t) {
    assertFalse(t.fallsWithin(p), "falls within? " + p.pos);
}
function testQTree() {
    function mp(x, y) {
        return new Particle(x, y);
    }
    var t = new QuadTree(createVector(200, 300), 50, 40);
    assertNotFallsWithin(mp(0, 100), t);
    assertNotFallsWithin(mp(251, 300), t);
    assertNotFallsWithin(mp(149, 300), t);
    assertFallsWithin(mp(176, 281), t);
    assertNotFallsWithin(mp(174, 281), t);
    assertTrue(t.insert(mp(180, 290)), "accept point");
    assertTrue(t.insert(mp(201, 301)), "accept point");
    var r1 = new Rectangle(920, 780, 140, 120);
    var r2 = new Rectangle(918, 720, 100, 140);
    debugger;
    assertTrue(r1.overlaps(r2), "should overlap");
}
function randomScreenPosition() {
    return createVector(random(width), random(height));
}
function centerScreenPos() {
    return createVector(width / 2, height / 2);
}
function randomInt(min, max) {
    return round(random(min, max));
}
function translateToVec(pos) {
    translate(pos.x, pos.y);
}
function minBy(list, fn) {
    if (list.length < 0) {
        return undefined;
    }
    var recordItem = list[0];
    var recordWeight = fn(list[0]);
    for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {
        var item = list_1[_i];
        var weight = fn(item);
        if (weight > recordWeight) {
            recordWeight = weight;
            recordItem = item;
        }
    }
    return recordItem;
}
function repeat(num, fn) {
    for (var i = 0; i < num; i++) {
        fn(i);
    }
}
function randomBoolean() {
    return Math.random() > 0.5;
}
function mousePosAsVector() {
    return createVector(mouseX, mouseY);
}
function timeIt(fn) {
    var a = millis();
    fn();
    return millis() - a;
}
var gPoints;
var qtree;
var qtreeFromScratch;
var gQueryRectangle;
var isGridOn = false;
var isDrawAllPoints = false;
var isDrawQueryResults = true;
function toggleDrawAllPoints() {
    isDrawAllPoints = !isDrawAllPoints;
    return isDrawAllPoints;
}
function toggleDrawQueryResults() {
    isDrawQueryResults = !isDrawQueryResults;
    return isDrawQueryResults;
}
function setup() {
    createCanvas(windowWidth, windowHeight);
    gPoints = [];
    var center = createVector(width / 2, height / 2);
    qtree = new QuadTree(center, width, height);
    repeat(100000, function (ix) { return gPoints.push(Particle.perlinRandomOnScreen(ix)); });
}
function mouseDragged() {
    var p = new Particle(mouseX, mouseY);
    gPoints.push(p);
    qtree.insert(p);
}
function update() {
    gQueryRectangle = new Rectangle(mouseX, mouseY, 100, 100);
    gTimings.timeToBuild = timeIt(function () {
        qtreeFromScratch = QuadTree.build(width / 2, height / 2, width, height, gPoints);
    });
    gTimings.timeToQuery = timeIt(function () { return (gQueryResults = qtreeFromScratch.query(gQueryRectangle)); });
    gTimings.timeToLocateNaively = timeIt(function () {
        return gPoints.filter(function (p) { return dist(p.pos.x, p.pos.y, mouseX, mouseY) < 100; });
    });
}
function draw() {
    gTimings.update = timeIt(function () { return update(); });
    gTimings.drawOnly = timeIt(function () { return drawOnly(); });
}
function drawOnly() {
    background("black");
    if (isGridOn) {
        drawDebugGrid();
    }
    drawQuadTreeForP5(qtree);
    if (isDrawAllPoints) {
        stroke("white");
        strokeWeight(2);
        for (var _i = 0, gPoints_1 = gPoints; _i < gPoints_1.length; _i++) {
            var p = gPoints_1[_i];
            point(p.pos.x, p.pos.y);
        }
    }
    rectMode(CENTER);
    noFill();
    stroke("orange");
    strokeWeight(0.3);
    rect(gQueryRectangle.cx, gQueryRectangle.cy, gQueryRectangle.w, gQueryRectangle.h);
    if (isDrawQueryResults) {
        strokeWeight(7);
        stroke("red");
        for (var _a = 0, gQueryResults_1 = gQueryResults; _a < gQueryResults_1.length; _a++) {
            var p = gQueryResults_1[_a];
            point(p.pos.x, p.pos.y);
        }
    }
    logLines(50, height - 400, [
        "FPS: " + frameRate().toFixed(2),
        "query count: " + gQueryResults.length,
        "full count: " + gPoints.length,
        "update() (ms): " + gTimings.update.toFixed(2),
        "drawOnly() (not update) (ms): " + gTimings.drawOnly.toFixed(2),
        "query time (ms): " + gTimings.timeToQuery.toFixed(2),
        "Rebuild time (ms): " + gTimings.timeToBuild.toFixed(0),
        "Naive query (ms):" + gTimings.timeToLocateNaively.toFixed(2)
    ]);
}
var gTimings = {
    timeToBuild: 0,
    timeToQuery: 0,
    update: 0,
    drawOnly: 0,
    timeToLocateNaively: 0
};
var gQueryResults;
function logLines(x, y, lines) {
    var lineHeight = 40;
    textSize(30);
    fill("gray");
    stroke("whitesmoke");
    rectMode(CORNER);
    rect(x - 30, y - 30, width - 60, lines.length * lineHeight + 60);
    noStroke();
    fill("black");
    push();
    translate(x, y);
    lines.forEach(function (line, ix) {
        translate(0, lineHeight);
        text(line, 0, 0);
    });
    pop();
}
function drawDebugGrid() {
    noStroke();
    fill("gray");
    textSize(8);
    for (var x = 0; x < width; x += 50) {
        for (var y = 0; y < height; y += 50) {
            text(x + "," + y, x, y);
        }
    }
}
function keyPressed() {
    if (key == "d") {
        toggleDrawAllPoints();
    }
    if (key == "q") {
        toggleDrawQueryResults();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLi9qcy8iLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiUGFydGljbGUudHMiLCJRdWFkVHJlZS50cyIsIlJlY3RhbmdsZS50cyIsIlRlc3RpbmdRdWFkVHJlZS50cyIsIlV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQztBQ0FiO0lBT0Usa0JBQVksQ0FBUyxFQUFFLENBQVM7UUFDOUIsSUFBSSxDQUFDLEdBQUcsR0FBRyxZQUFZLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFQRCx1QkFBSSxHQUFKO1FBQ0UsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2hCLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoQixLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBSU0sdUJBQWMsR0FBckI7UUFDRSxPQUFPLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBQ00sNkJBQW9CLEdBQTNCLFVBQTRCLEVBQVU7UUFDcEMsSUFBSSxDQUFDLEdBQUcsS0FBSyxHQUFHLEtBQUssQ0FBQyxFQUFFLEdBQUcsVUFBVSxHQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQzdDLElBQUksQ0FBQyxHQUFHLE1BQU0sR0FBRyxLQUFLLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxVQUFVLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDbEQsT0FBTyxJQUFJLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUNILGVBQUM7QUFBRCxDQUFDLEFBbEJELElBa0JDO0FDakJELElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQztBQUduQjtJQXNFRSxrQkFB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cmljdFwiO1xuLy9wNS5kaXNhYmxlRnJpZW5kbHlFcnJvcnMgPSB0cnVlO1xuXG4vL0NyZWRpdHM6IHVzZXMgcG9pbnQtcmVjdGFuZ2xlIGFuZCByZWN0YW5nbGUtcmVjdGFuZ2xlIGNvbGxpc2lvbiBtYXRoIGZyb206XG4vLyBodHRwczovL2dpdGh1Yi5jb20vYm1vcmVuL3A1LmNvbGxpZGUyRC9ibG9iL21hc3Rlci9wNS5jb2xsaWRlMmQuanNcbi8vIGxpY2Vuc2U6IGh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1uYy1zYS80LjAvXG5cbmludGVyZmFjZSBQb2ludCB7XG4gIHBvczogcDUuVmVjdG9yO1xufVxuXG5sZXQgZ1BvaW50czogUGFydGljbGVbXTtcbmxldCBxdHJlZTogUXVhZFRyZWU7XG5sZXQgcXRyZWVGcm9tU2NyYXRjaDogUXVhZFRyZWU7XG5sZXQgZ1F1ZXJ5UmVjdGFuZ2xlOiBSZWN0YW5nbGU7XG5sZXQgaXNHcmlkT24gPSBmYWxzZTtcbmxldCBpc0RyYXdBbGxQb2ludHMgPSBmYWxzZTtcbmxldCBpc0RyYXdRdWVyeVJlc3VsdHMgPSB0cnVlO1xuXG5mdW5jdGlvbiB0b2dnbGVEcmF3QWxsUG9pbnRzKCk6IGJvb2xlYW4ge1xuICBpc0RyYXdBbGxQb2ludHMgPSAhaXNEcmF3QWxsUG9pbnRzO1xuICByZXR1cm4gaXNEcmF3QWxsUG9pbnRzO1xufVxuZnVuY3Rpb24gdG9nZ2xlRHJhd1F1ZXJ5UmVzdWx0cygpOiBib29sZWFuIHtcbiAgaXNEcmF3UXVlcnlSZXN1bHRzID0gIWlzRHJhd1F1ZXJ5UmVzdWx0cztcbiAgcmV0dXJuIGlzRHJhd1F1ZXJ5UmVzdWx0cztcbn1cblxuZnVuY3Rpb24gc2V0dXAoKSB7XG4gIGNyZWF0ZUNhbnZhcyh3aW5kb3dXaWR0aCwgd2luZG93SGVpZ2h0KTtcbiAgZ1BvaW50cyA9IFtdO1xuICBjb25zdCBjZW50ZXIgPSBjcmVhdGVWZWN0b3Iod2lkdGggLyAyLCBoZWlnaHQgLyAyKTtcbiAgcXRyZWUgPSBuZXcgUXVhZFRyZWUoY2VudGVyLCB3aWR0aCwgaGVpZ2h0KTtcbiAgcmVwZWF0KDEwMDAwMCwgaXggPT4gZ1BvaW50cy5wdXNoKFBhcnRpY2xlLnBlcmxpblJhbmRvbU9uU2NyZWVuKGl4KSkpO1xuICAvL3Rlc3RRVHJlZSgpO1xufVxuXG5mdW5jdGlvbiBtb3VzZURyYWdnZWQoKSB7XG4gIGxldCBwID0gbmV3IFBhcnRpY2xlKG1vdXNlWCwgbW91c2VZKTtcbiAgZ1BvaW50cy5wdXNoKHApO1xuICBxdHJlZS5pbnNlcnQocCk7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgZ1F1ZXJ5UmVjdGFuZ2xlID0gbmV3IFJlY3RhbmdsZShtb3VzZVgsIG1vdXNlWSwgMTAwLCAxMDApO1xuICBnVGltaW5ncy50aW1lVG9CdWlsZCA9IHRpbWVJdCgoKSA9PiB7XG4gICAgcXRyZWVGcm9tU2NyYXRjaCA9IFF1YWRUcmVlLmJ1aWxkKFxuICAgICAgd2lkdGggLyAyLFxuICAgICAgaGVpZ2h0IC8gMixcbiAgICAgIHdpZHRoLFxuICAgICAgaGVpZ2h0LFxuICAgICAgZ1BvaW50c1xuICAgICk7XG4gIH0pO1xuICAvL21ha2UgdGhlIHF1ZXJ5IGFuZCBoaWdobGlnaHQgdGhlIHBvaW50cyBpdCByZXR1cm5zXG4gIGdUaW1pbmdzLnRpbWVUb1F1ZXJ5ID0gdGltZUl0KFxuICAgICgpID0+IChnUXVlcnlSZXN1bHRzID0gcXRyZWVGcm9tU2NyYXRjaC5xdWVyeShnUXVlcnlSZWN0YW5nbGUpKVxuICApO1xuICBnVGltaW5ncy50aW1lVG9Mb2NhdGVOYWl2ZWx5ID0gdGltZUl0KCgpID0+XG4gICAgZ1BvaW50cy5maWx0ZXIocCA9PiBkaXN0KHAucG9zLngsIHAucG9zLnksIG1vdXNlWCwgbW91c2VZKSA8IDEwMClcbiAgKTtcbn1cblxuZnVuY3Rpb24gZHJhdygpIHtcbiAgZ1RpbWluZ3MudXBkYXRlID0gdGltZUl0KCgpID0+IHVwZGF0ZSgpKTtcbiAgZ1RpbWluZ3MuZHJhd09ubHkgPSB0aW1lSXQoKCkgPT4gZHJhd09ubHkoKSk7XG59XG5mdW5jdGlvbiBkcmF3T25seSgpIHtcbiAgYmFja2dyb3VuZChcImJsYWNrXCIpO1xuICBpZiAoaXNHcmlkT24pIHtcbiAgICBkcmF3RGVidWdHcmlkKCk7XG4gIH1cbiAgZHJhd1F1YWRUcmVlRm9yUDUocXRyZWUpO1xuXG4gIGlmIChpc0RyYXdBbGxQb2ludHMpIHtcbiAgICAvL2RyYXcgQUxMIHRoZSBwb2ludHMgaW4gdGhlIGRlbW9cbiAgICBzdHJva2UoXCJ3aGl0ZVwiKTtcbiAgICBzdHJva2VXZWlnaHQoMik7XG5cbiAgICBmb3IgKGxldCBwIG9mIGdQb2ludHMpIHtcbiAgICAgIHBvaW50KHAucG9zLngsIHAucG9zLnkpO1xuICAgIH1cbiAgfVxuXG4gIC8vZHJhdyB0aGUgcXVlcnkgcmVjdGFuZ2xlIChmb2xsb3dzIHRoZSBtb3VzZSlcbiAgcmVjdE1vZGUoQ0VOVEVSKTtcbiAgbm9GaWxsKCk7XG4gIHN0cm9rZShcIm9yYW5nZVwiKTtcbiAgc3Ryb2tlV2VpZ2h0KDAuMyk7XG4gIHJlY3QoXG4gICAgZ1F1ZXJ5UmVjdGFuZ2xlLmN4LFxuICAgIGdRdWVyeVJlY3RhbmdsZS5jeSxcbiAgICBnUXVlcnlSZWN0YW5nbGUudyxcbiAgICBnUXVlcnlSZWN0YW5nbGUuaFxuICApO1xuXG4gIC8vIHF0cmVlLnF1ZXJ5KHF1ZXJ5UmVjdGFuZ2xlKTtcbiAgaWYgKGlzRHJhd1F1ZXJ5UmVzdWx0cykge1xuICAgIHN0cm9rZVdlaWdodCg3KTtcbiAgICBzdHJva2UoXCJyZWRcIik7XG4gICAgZm9yIChsZXQgcCBvZiBnUXVlcnlSZXN1bHRzKSB7XG4gICAgICBwb2ludChwLnBvcy54LCBwLnBvcy55KTtcbiAgICB9XG4gIH1cblxuICAvL2RlYnVnZ2luZyBjb3VudFxuICBsb2dMaW5lcyg1MCwgaGVpZ2h0IC0gNDAwLCBbXG4gICAgXCJGUFM6IFwiICsgZnJhbWVSYXRlKCkudG9GaXhlZCgyKSxcbiAgICBcInF1ZXJ5IGNvdW50OiBcIiArIGdRdWVyeVJlc3VsdHMubGVuZ3RoLFxuICAgIFwiZnVsbCBjb3VudDogXCIgKyBnUG9pbnRzLmxlbmd0aCxcbiAgICBcInVwZGF0ZSgpIChtcyk6IFwiICsgZ1RpbWluZ3MudXBkYXRlLnRvRml4ZWQoMiksXG4gICAgXCJkcmF3T25seSgpIChub3QgdXBkYXRlKSAobXMpOiBcIiArIGdUaW1pbmdzLmRyYXdPbmx5LnRvRml4ZWQoMiksXG4gICAgXCJxdWVyeSB0aW1lIChtcyk6IFwiICsgZ1RpbWluZ3MudGltZVRvUXVlcnkudG9GaXhlZCgyKSxcbiAgICBcIlJlYnVpbGQgdGltZSAobXMpOiBcIiArIGdUaW1pbmdzLnRpbWVUb0J1aWxkLnRvRml4ZWQoMCksXG4gICAgXCJOYWl2ZSBxdWVyeSAobXMpOlwiICsgZ1RpbWluZ3MudGltZVRvTG9jYXRlTmFpdmVseS50b0ZpeGVkKDIpXG4gIF0pO1xufVxuXG5sZXQgZ1RpbWluZ3MgPSB7XG4gIHRpbWVUb0J1aWxkOiAwLFxuICB0aW1lVG9RdWVyeTogMCxcbiAgdXBkYXRlOiAwLFxuICBkcmF3T25seTogMCxcbiAgdGltZVRvTG9jYXRlTmFpdmVseTogMFxufTtcbmxldCBnUXVlcnlSZXN1bHRzOiBQb2ludFtdO1xuXG5mdW5jdGlvbiBsb2dMaW5lcyh4OiBudW1iZXIsIHk6IG51bWJlciwgbGluZXM6IHN0cmluZ1tdKSB7XG4gIGNvbnN0IGxpbmVIZWlnaHQgPSA0MDtcbiAgdGV4dFNpemUoMzApO1xuICBmaWxsKFwiZ3JheVwiKTtcbiAgc3Ryb2tlKFwid2hpdGVzbW9rZVwiKTtcbiAgcmVjdE1vZGUoQ09STkVSKTtcbiAgcmVjdCh4IC0gMzAsIHkgLSAzMCwgd2lkdGggLSA2MCwgbGluZXMubGVuZ3RoICogbGluZUhlaWdodCArIDYwKTtcbiAgbm9TdHJva2UoKTtcbiAgZmlsbChcImJsYWNrXCIpO1xuXG4gIHB1c2goKTtcbiAgdHJhbnNsYXRlKHgsIHkpO1xuICBsaW5lcy5mb3JFYWNoKChsaW5lOiBzdHJpbmcsIGl4OiBudW1iZXIpID0+IHtcbiAgICB0cmFuc2xhdGUoMCwgbGluZUhlaWdodCk7XG4gICAgdGV4dChsaW5lLCAwLCAwKTtcbiAgfSk7XG4gIHBvcCgpO1xufVxuZnVuY3Rpb24gZHJhd0RlYnVnR3JpZCgpIHtcbiAgbm9TdHJva2UoKTtcbiAgZmlsbChcImdyYXlcIik7XG4gIHRleHRTaXplKDgpO1xuICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyB4ICs9IDUwKSB7XG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7IHkgKz0gNTApIHtcbiAgICAgIHRleHQoYCR7eH0sJHt5fWAsIHgsIHkpO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24ga2V5UHJlc3NlZCgpIHtcbiAgaWYgKGtleSA9PSBcImRcIikge1xuICAgIHRvZ2dsZURyYXdBbGxQb2ludHMoKTtcbiAgfVxuICBpZiAoa2V5ID09IFwicVwiKSB7XG4gICAgdG9nZ2xlRHJhd1F1ZXJ5UmVzdWx0cygpO1xuICB9XG59XG4iLCJjbGFzcyBQYXJ0aWNsZSB7XG4gIHBvczogcDUuVmVjdG9yO1xuICBkcmF3KCk6IHZvaWQge1xuICAgIHN0cm9rZShcIndoaXRlXCIpO1xuICAgIHN0cm9rZVdlaWdodCgxKTtcbiAgICBwb2ludCh0aGlzLnBvcy54LCB0aGlzLnBvcy55KTtcbiAgfVxuICBjb25zdHJ1Y3Rvcih4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgIHRoaXMucG9zID0gY3JlYXRlVmVjdG9yKHgsIHkpO1xuICB9XG4gIHN0YXRpYyByYW5kb21PblNjcmVlbigpOiBQYXJ0aWNsZSB7XG4gICAgcmV0dXJuIG5ldyBQYXJ0aWNsZShyYW5kb20od2lkdGgpLCByYW5kb20oaGVpZ2h0KSk7XG4gIH1cbiAgc3RhdGljIHBlcmxpblJhbmRvbU9uU2NyZWVuKGl4OiBudW1iZXIpOiBQYXJ0aWNsZSB7XG4gICAgbGV0IHggPSB3aWR0aCAqIG5vaXNlKGl4ICsgZnJhbWVDb3VudCAvIDEwMCk7XG4gICAgbGV0IHkgPSBoZWlnaHQgKiBub2lzZSg3ICogaXggKyBmcmFtZUNvdW50IC8gMTIzKTtcbiAgICByZXR1cm4gbmV3IFBhcnRpY2xlKHgsIHkpO1xuICB9XG59XG4iLCIvL2hhY2t5XG5sZXQgZ1FUQ291bnRlciA9IDA7XG5cbi8vVE9ETzogcmVtb3ZlIHA1LlZlY3RvciAtIGhhdmUgbm8gZGVwZW5kZW5jZSBvbiBwNVxuY2xhc3MgUXVhZFRyZWUge1xuICBzdGF0aWMgYnVpbGQoXG4gICAgY3g6IG51bWJlcixcbiAgICBjeTogbnVtYmVyLFxuICAgIHc6IG51bWJlcixcbiAgICBoOiBudW1iZXIsXG4gICAgZ1BvaW50czogUGFydGljbGVbXVxuICApOiBRdWFkVHJlZSB7XG4gICAgY29uc3QgdCA9IG5ldyBRdWFkVHJlZShjcmVhdGVWZWN0b3IoY3gsIGN5KSwgdywgaCk7XG4gICAgZ1BvaW50cy5mb3JFYWNoKHAgPT4gdC5pbnNlcnQocCkpO1xuICAgIHJldHVybiB0O1xuICB9XG4gIGluc2VydChwOiBQb2ludCk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5mYWxsc1dpdGhpbihwKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvL2FjY2VwdCBkaXJlY3RseSwgb3IgZGVsZWdhdGVcbiAgICBpZiAodGhpcy5kaXJlY3RseUNvbnRhaW5lZFBvaW50cy5sZW5ndGggPCB0aGlzLmNhcGFjaXR5KSB7XG4gICAgICB0aGlzLmRpcmVjdGx5Q29udGFpbmVkUG9pbnRzLnB1c2gocCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCF0aGlzLmlzU3ViZGl2aWRlZCgpKSB7XG4gICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7XG4gICAgICB9XG4gICAgICAvL2RlbGVnYXRlXG4gICAgICBpZiAodGhpcy5uZS5pbnNlcnQocCkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5udy5pbnNlcnQocCkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5zZS5pbnNlcnQocCkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5zdy5pbnNlcnQocCkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIFwiU2hvdWxkIGJlIHVucmVhY2hhYmxlLiAgQWxsIHN1YnF1YWRzIHJlamVjdCBwb2ludCBpbnNlcnRpb24uXCJcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIHN1YmRpdmlkZSgpIHtcbiAgICBjb25zdCBjeCA9IHRoaXMucmVjdGFuZ2xlLmN4O1xuICAgIGNvbnN0IGN5ID0gdGhpcy5yZWN0YW5nbGUuY3k7XG4gICAgY29uc3QgcVcgPSB0aGlzLnJlY3RhbmdsZS53IC8gNDsgLy9xdWFydGVyIHdpZHRoLCBxdWFydGVyIGhlaWdodFxuICAgIGNvbnN0IHFIID0gdGhpcy5yZWN0YW5nbGUuaCAvIDQ7XG4gICAgY29uc3QgaFcgPSBxVyAqIDI7IC8vIGhhbGYgd2lkdGgsIGhhbGYgaGVpZ2h0XG4gICAgY29uc3QgaEggPSBxSCAqIDI7XG5cbiAgICB0aGlzLm5lID0gbmV3IFF1YWRUcmVlKGN2KGN4ICsgcVcsIGN5IC0gcUgpLCBoVywgaEgpO1xuICAgIHRoaXMubncgPSBuZXcgUXVhZFRyZWUoY3YoY3ggLSBxVywgY3kgLSBxSCksIGhXLCBoSCk7XG4gICAgdGhpcy5zZSA9IG5ldyBRdWFkVHJlZShjdihjeCArIHFXLCBjeSArIHFIKSwgaFcsIGhIKTtcbiAgICB0aGlzLnN3ID0gbmV3IFF1YWRUcmVlKGN2KGN4IC0gcVcsIGN5ICsgcUgpLCBoVywgaEgpO1xuICB9XG5cbiAgLy9tb2RpZmllZCBmcm9tIHA1LmNvbGxpZGUyZC5qcyBodHRwczovL2dpdGh1Yi5jb20vYm1vcmVuL3A1LmNvbGxpZGUyRC9ibG9iL21hc3Rlci9wNS5jb2xsaWRlMmQuanNcbiAgZmFsbHNXaXRoaW4ocDogUG9pbnQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5yZWN0YW5nbGUuZmFsbHNXaXRoaW4ocCk7XG4gIH1cblxuICBkaXJlY3RseUNvbnRhaW5lZFBvaW50czogUG9pbnRbXTtcbiAgY2FwYWNpdHk6IG51bWJlcjtcbiAgbmU/OiBRdWFkVHJlZTtcbiAgc2U/OiBRdWFkVHJlZTtcbiAgbnc/OiBRdWFkVHJlZTtcbiAgc3c/OiBRdWFkVHJlZTtcblxuICByZWN0YW5nbGU6IFJlY3RhbmdsZTtcbiAgbXlJRDogbnVtYmVyO1xuICBjb25zdHJ1Y3RvcihjZW50ZXI6IHA1LlZlY3RvciwgdzogbnVtYmVyLCBoOiBudW1iZXIpIHtcbiAgICB0aGlzLm15SUQgPSBnUVRDb3VudGVyKys7XG4gICAgdGhpcy5yZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKGNlbnRlci54LCBjZW50ZXIueSwgdywgaCk7XG4gICAgdGhpcy5kaXJlY3RseUNvbnRhaW5lZFBvaW50cyA9IFtdO1xuICAgIHRoaXMuY2FwYWNpdHkgPSAyMDtcbiAgfVxuICBpc1N1YmRpdmlkZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMubmUgIT09IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHF1ZXJ5KHF1ZXJ5UmVjdGFuZ2xlOiBSZWN0YW5nbGUsIHJlc3VsdHM/OiBQb2ludFtdKTogUG9pbnRbXSB7XG4gICAgaWYgKHJlc3VsdHMgPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXN1bHRzID0gW107XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucmVjdGFuZ2xlLm92ZXJsYXBzKHF1ZXJ5UmVjdGFuZ2xlKSkge1xuICAgICAgcmVzdWx0cy5wdXNoKFxuICAgICAgICAuLi50aGlzLmRpcmVjdGx5Q29udGFpbmVkUG9pbnRzLmZpbHRlcihwID0+XG4gICAgICAgICAgcXVlcnlSZWN0YW5nbGUuZmFsbHNXaXRoaW4ocClcbiAgICAgICAgKVxuICAgICAgKTtcblxuICAgICAgaWYgKHRoaXMuaXNTdWJkaXZpZGVkKCkpIHtcbiAgICAgICAgZm9yIChsZXQgc3VidHJlZSBvZiBbdGhpcy5uZSwgdGhpcy5udywgdGhpcy5zZSwgdGhpcy5zd10pIHtcbiAgICAgICAgICBzdWJ0cmVlLnF1ZXJ5KHF1ZXJ5UmVjdGFuZ2xlLCByZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG59XG5jb25zdCBjdiA9ICh4OiBudW1iZXIsIHk6IG51bWJlcikgPT4gY3JlYXRlVmVjdG9yKHgsIHkpO1xuXG4vL1RPRE86IHRoaXMgcmVxdWlyZXMgcDUuICBrZWVwIHNlcGFyYXRlIGZyb20gbGlicmFyeS1pbmRlcGVuZGVudCBxdWFkdHJlZSBjb2RlXG5mdW5jdGlvbiBkcmF3UXVhZFRyZWVGb3JQNSh0cmVlOiBRdWFkVHJlZSk6IHZvaWQge1xuICBzdHJva2UoXCJ5ZWxsb3dcIik7XG4gIHN0cm9rZVdlaWdodCgwLjMpO1xuICBub0ZpbGwoKTtcbiAgcmVjdE1vZGUoQ0VOVEVSKTtcbiAgcmVjdChcbiAgICB0cmVlLnJlY3RhbmdsZS5jeCxcbiAgICB0cmVlLnJlY3RhbmdsZS5jeSxcbiAgICB0cmVlLnJlY3RhbmdsZS53LFxuICAgIHRyZWUucmVjdGFuZ2xlLmhcbiAgKTtcblxuICBub1N0cm9rZSgpO1xuICBmaWxsKFwid2hpdGVcIik7XG4gIHRleHRTaXplKDEwKTtcbiAgdGV4dCh0cmVlLm15SUQsIHRyZWUucmVjdGFuZ2xlLmN4LCB0cmVlLnJlY3RhbmdsZS5jeSk7XG4gIC8vdGV4dCh0cmVlLmRpcmVjdGx5Q29udGFpbmVkUG9pbnRzLmxlbmd0aCwgdHJlZS5jZW50ZXIueCwgdHJlZS5jZW50ZXIueSk7XG5cbiAgaWYgKHRyZWUuaXNTdWJkaXZpZGVkKCkpIHtcbiAgICBmb3IgKGxldCBzdWJ0cmVlIG9mIFt0cmVlLm5lLCB0cmVlLm53LCB0cmVlLnNlLCB0cmVlLnN3XSkge1xuICAgICAgZHJhd1F1YWRUcmVlRm9yUDUoc3VidHJlZSk7XG4gICAgfVxuICB9XG59XG4iLCJjbGFzcyBSZWN0YW5nbGUge1xuICBjeDogbnVtYmVyO1xuICBjeTogbnVtYmVyO1xuXG4gIHQ6IG51bWJlcjtcbiAgYjogbnVtYmVyO1xuICBsOiBudW1iZXI7XG4gIHI6IG51bWJlcjtcblxuICB3OiBudW1iZXI7XG4gIGg6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihjeDogbnVtYmVyLCBjeTogbnVtYmVyLCB3OiBudW1iZXIsIGg6IG51bWJlcikge1xuICAgIHRoaXMuY3ggPSBjeDtcbiAgICB0aGlzLmN5ID0gY3k7XG4gICAgdGhpcy53ID0gdztcbiAgICB0aGlzLmggPSBoO1xuICAgIHRoaXMudCA9IHRoaXMuY3kgLSBoIC8gMjtcbiAgICB0aGlzLmIgPSB0aGlzLmN5ICsgaCAvIDI7XG4gICAgdGhpcy5sID0gdGhpcy5jeCAtIHcgLyAyO1xuICAgIHRoaXMuciA9IHRoaXMuY3ggKyB3IC8gMjtcbiAgfVxuXG4gIC8vbW9kaWZpZWQgZnJvbSBjb2xsaWRlUG9pbnRSZWN0O1xuICAvL2h0dHBzOi8vZ2l0aHViLmNvbS9ibW9yZW4vcDUuY29sbGlkZTJEL2Jsb2IvbWFzdGVyL3A1LmNvbGxpZGUyZC5qc1xuICBmYWxsc1dpdGhpbihwOiBQb2ludCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICBwLnBvcy54ID49IHRoaXMubCAmJiAvLyByaWdodCBvZiB0aGUgbGVmdCBlZGdlIEFORFxuICAgICAgcC5wb3MueCA8PSB0aGlzLnIgJiYgLy8gbGVmdCBvZiB0aGUgcmlnaHQgZWRnZSBBTkRcbiAgICAgIHAucG9zLnkgPj0gdGhpcy50ICYmIC8vIGJlbG93IHRoZSB0b3AgQU5EXG4gICAgICBwLnBvcy55IDw9IHRoaXMuYiAvLyBhYm92ZSB0aGUgYm90dG9tXG4gICAgKTtcbiAgfVxuXG4gIC8vbW9kaWZpZWQgZnJvbSBjb2xsaWRlUmVjdFJlY3Q7XG4gIC8vaHR0cHM6Ly9naXRodWIuY29tL2Jtb3Jlbi9wNS5jb2xsaWRlMkQvYmxvYi9tYXN0ZXIvcDUuY29sbGlkZTJkLmpzXG4gIG92ZXJsYXBzKHIyOiBSZWN0YW5nbGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5yID49IHIyLmwgJiYgLy8gbXkgcmlnaHQgaXMgcmlnaHQgb2YgeW91ciBsZWZ0XG4gICAgICB0aGlzLmwgPD0gcjIuciAmJiAvLyBteSBsZWZ0IGlzIGxlZnQgb2YgeW91ciByaWdodFxuICAgICAgdGhpcy50IDw9IHIyLmIgJiYgLy8gbXkgdXBwZXIgaXMgYWJvdmUgeW91ciBsb3dlclxuICAgICAgdGhpcy5iID49IHIyLnQgLy8gbXkgbG93ZXIgaXMgbG93ZXIgdGhhbiB5b3VyIHVwcGVyXG4gICAgKTtcbiAgfVxufVxuIiwiZnVuY3Rpb24gYXNzZXJ0VHJ1ZShhc3NlcnRpb246IGJvb2xlYW4sIHRleHQ6IHN0cmluZyk6IHZvaWQge1xuICBpZiAoIWFzc2VydGlvbikge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkFzc2VydGlvbkVycm9yOiBFeHBlY3RlZCB0cnVlLCBnb3QgZmFsc2U6IFwiICsgdGV4dCk7XG4gIH1cbn1cbmZ1bmN0aW9uIGFzc2VydEZhbHNlKGFzc2VydGlvbjogYm9vbGVhbiwgdGV4dDogc3RyaW5nKTogdm9pZCB7XG4gIGlmIChhc3NlcnRpb24pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJBc3NlcnRpb25FcnJvcjogRXhwZWN0ZWQgZmFsc2UsIGdvdCB0cnVlOiBcIiArIHRleHQpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFzc2VydEZhbGxzV2l0aGluKHA6IFBvaW50LCB0OiBRdWFkVHJlZSkge1xuICBhc3NlcnRUcnVlKHQuZmFsbHNXaXRoaW4ocCksIGBmYWxscyB3aXRoaW4/ICR7cC5wb3N9YCk7XG59XG5mdW5jdGlvbiBhc3NlcnROb3RGYWxsc1dpdGhpbihwOiBQb2ludCwgdDogUXVhZFRyZWUpIHtcbiAgYXNzZXJ0RmFsc2UodC5mYWxsc1dpdGhpbihwKSwgYGZhbGxzIHdpdGhpbj8gJHtwLnBvc31gKTtcbn1cblxuZnVuY3Rpb24gdGVzdFFUcmVlKCk6IHZvaWQge1xuICBmdW5jdGlvbiBtcCh4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgIHJldHVybiBuZXcgUGFydGljbGUoeCwgeSk7XG4gIH1cbiAgY29uc3QgdCA9IG5ldyBRdWFkVHJlZShjcmVhdGVWZWN0b3IoMjAwLCAzMDApLCA1MCwgNDApO1xuXG4gIGFzc2VydE5vdEZhbGxzV2l0aGluKG1wKDAsIDEwMCksIHQpO1xuXG4gIGFzc2VydE5vdEZhbGxzV2l0aGluKG1wKDI1MSwgMzAwKSwgdCk7XG4gIGFzc2VydE5vdEZhbGxzV2l0aGluKG1wKDE0OSwgMzAwKSwgdCk7XG5cbiAgYXNzZXJ0RmFsbHNXaXRoaW4obXAoMTc2LCAyODEpLCB0KTtcbiAgYXNzZXJ0Tm90RmFsbHNXaXRoaW4obXAoMTc0LCAyODEpLCB0KTtcblxuICBhc3NlcnRUcnVlKHQuaW5zZXJ0KG1wKDE4MCwgMjkwKSksIFwiYWNjZXB0IHBvaW50XCIpO1xuICBhc3NlcnRUcnVlKHQuaW5zZXJ0KG1wKDIwMSwgMzAxKSksIFwiYWNjZXB0IHBvaW50XCIpO1xuXG4gIGxldCByMSA9IG5ldyBSZWN0YW5nbGUoOTIwLCA3ODAsIDE0MCwgMTIwKTtcbiAgbGV0IHIyID0gbmV3IFJlY3RhbmdsZSg5MTgsIDcyMCwgMTAwLCAxNDApO1xuICBkZWJ1Z2dlcjtcbiAgYXNzZXJ0VHJ1ZShyMS5vdmVybGFwcyhyMiksIFwic2hvdWxkIG92ZXJsYXBcIik7XG59XG4iLCJmdW5jdGlvbiByYW5kb21TY3JlZW5Qb3NpdGlvbigpOiBwNS5WZWN0b3Ige1xuICByZXR1cm4gY3JlYXRlVmVjdG9yKHJhbmRvbSh3aWR0aCksIHJhbmRvbShoZWlnaHQpKTtcbn1cblxuZnVuY3Rpb24gY2VudGVyU2NyZWVuUG9zKCk6IHA1LlZlY3RvciB7XG4gIHJldHVybiBjcmVhdGVWZWN0b3Iod2lkdGggLyAyLCBoZWlnaHQgLyAyKTtcbn1cblxuZnVuY3Rpb24gcmFuZG9tSW50KG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiByb3VuZChyYW5kb20obWluLCBtYXgpKTtcbn1cblxuZnVuY3Rpb24gdHJhbnNsYXRlVG9WZWMocG9zOiBwNS5WZWN0b3IpOiB2b2lkIHtcbiAgdHJhbnNsYXRlKHBvcy54LCBwb3MueSk7XG59XG5cbi8qKiBGaW5kIHRoZSBtaW5pbXVtIG9mIHRoZSBnaXZlbiBsaXN0IGFmdGVyIGFwcGx5aW5nIGZuKCkgdG8gZWFjaC5cbiAqIFJldHVybiB0aGUgbWluaW11bSwgZmlyc3QgbWluaW11bSwgb3IgdW5kZWZpbmVkIGlmIHRoZXJlIGFyZSBubyBpdGVtcy5cbiAqL1xuZnVuY3Rpb24gbWluQnk8VD4obGlzdDogVFtdLCBmbjogKGl0ZW06IFQpID0+IG51bWJlcik6IFQge1xuICBpZiAobGlzdC5sZW5ndGggPCAwKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBsZXQgcmVjb3JkSXRlbSA9IGxpc3RbMF07XG4gIGxldCByZWNvcmRXZWlnaHQgPSBmbihsaXN0WzBdKTtcbiAgZm9yIChsZXQgaXRlbSBvZiBsaXN0KSB7XG4gICAgY29uc3Qgd2VpZ2h0ID0gZm4oaXRlbSk7XG4gICAgaWYgKHdlaWdodCA+IHJlY29yZFdlaWdodCkge1xuICAgICAgcmVjb3JkV2VpZ2h0ID0gd2VpZ2h0O1xuICAgICAgcmVjb3JkSXRlbSA9IGl0ZW07XG4gICAgfVxuICB9XG4gIHJldHVybiByZWNvcmRJdGVtO1xufVxuXG4vKiogUmVwZWF0ZWRseSBjYWxsIHRoZSBnaXZlbiBmdW5jdGlvbiBmbiwgbnVtIHRpbWVzLCB0aHJvd2luZyBhbnkgb3V0cHV0IGF3YXkuICovXG5mdW5jdGlvbiByZXBlYXQobnVtOiBudW1iZXIsIGZuOiAoaXg6IG51bWJlcikgPT4gdm9pZCkge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IG51bTsgaSsrKSB7XG4gICAgZm4oaSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gcmFuZG9tQm9vbGVhbigpOiBib29sZWFuIHtcbiAgcmV0dXJuIE1hdGgucmFuZG9tKCkgPiAwLjU7XG59XG5cbmZ1bmN0aW9uIG1vdXNlUG9zQXNWZWN0b3IoKTogcDUuVmVjdG9yIHtcbiAgcmV0dXJuIGNyZWF0ZVZlY3Rvcihtb3VzZVgsIG1vdXNlWSk7XG59XG5cbmZ1bmN0aW9uIHRpbWVJdChmbjogKCkgPT4gdm9pZCkge1xuICBjb25zdCBhID0gbWlsbGlzKCk7XG4gIGZuKCk7XG4gIHJldHVybiBtaWxsaXMoKSAtIGE7XG59XG4iXX0=