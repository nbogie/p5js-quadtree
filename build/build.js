"use strict";
function drawQuadTree(tree) {
    stroke("yellow");
    strokeWeight(0.3);
    noFill();
    rectMode(CENTER);
    rect(tree.rectangle.cx, tree.rectangle.cy, tree.rectangle.w, tree.rectangle.h);
    noStroke();
    fill("white");
    textSize(10);
    text(tree.myID, tree.rectangle.cx, tree.rectangle.cy);
    if (tree.isSubdivided()) {
        for (var _i = 0, _a = [tree.ne, tree.nw, tree.se, tree.sw]; _i < _a.length; _i++) {
            var subtree = _a[_i];
            drawQuadTree(subtree);
        }
    }
}
var Particle = (function () {
    function Particle(x, y) {
        this.pos = createVector(x, y);
    }
    Particle.prototype.draw = function () {
        stroke("white");
        strokeWeight(1);
        point(this.pos.x, this.pos.y);
    };
    Particle.randomOnScreen = function () {
        return new Particle(random(width), random(height));
    };
    Particle.perlinRandomOnScreen = function (ix) {
        var x = width * noise(ix + frameCount / 100);
        var y = height * noise(7 * ix + frameCount / 123);
        return new Particle(x, y);
    };
    return Particle;
}());
var QuadTree = (function () {
    function QuadTree(center, w, h) {
        this.myID = QuadTree.staticQTCounter++;
        this.rectangle = new Rectangle(center.x, center.y, w, h);
        this.directlyContainedPoints = [];
        this.capacity = 20;
    }
    QuadTree.build = function (cx, cy, w, h, gPoints) {
        var t = new QuadTree(createVector(cx, cy), w, h);
        gPoints.forEach(function (p) { return t.insert(p); });
        return t;
    };
    QuadTree.prototype.insert = function (p) {
        if (!this.rectangle.fallsWithin(p)) {
            return false;
        }
        if (this.directlyContainedPoints.length < this.capacity) {
            this.directlyContainedPoints.push(p);
            return true;
        }
        else {
            if (!this.isSubdivided()) {
                this.subdivide();
            }
            if ([this.ne, this.nw, this.se, this.sw].some(function (qt) { return qt.insert(p); })) {
                return true;
            }
            throw new Error("Should be unreachable.  All subquads reject point insertion.");
        }
    };
    QuadTree.prototype.query = function (queryRectangle, results) {
        if (results == undefined) {
            results = [];
        }
        if (this.rectangle.overlaps(queryRectangle)) {
            results.push.apply(results, this.directlyContainedPoints.filter(function (p) {
                return queryRectangle.fallsWithin(p);
            }));
            if (this.isSubdivided()) {
                for (var _i = 0, _a = [this.ne, this.nw, this.se, this.sw]; _i < _a.length; _i++) {
                    var subtree = _a[_i];
                    subtree.query(queryRectangle, results);
                }
            }
        }
        return results;
    };
    QuadTree.prototype.subdivide = function () {
        var cx = this.rectangle.cx;
        var cy = this.rectangle.cy;
        var qW = this.rectangle.w / 4;
        var qH = this.rectangle.h / 4;
        var hW = qW * 2;
        var hH = qH * 2;
        this.ne = new QuadTree(createVector(cx + qW, cy - qH), hW, hH);
        this.nw = new QuadTree(createVector(cx - qW, cy - qH), hW, hH);
        this.se = new QuadTree(createVector(cx + qW, cy + qH), hW, hH);
        this.sw = new QuadTree(createVector(cx - qW, cy + qH), hW, hH);
    };
    QuadTree.prototype.isSubdivided = function () {
        return this.ne !== undefined;
    };
    QuadTree.staticQTCounter = 0;
    return QuadTree;
}());
var Rectangle = (function () {
    function Rectangle(cx, cy, w, h) {
        this.cx = cx;
        this.cy = cy;
        this.w = w;
        this.h = h;
        this.t = this.cy - h / 2;
        this.b = this.cy + h / 2;
        this.l = this.cx - w / 2;
        this.r = this.cx + w / 2;
    }
    Rectangle.prototype.fallsWithin = function (p) {
        return (p.pos.x >= this.l &&
            p.pos.x <= this.r &&
            p.pos.y >= this.t &&
            p.pos.y <= this.b);
    };
    Rectangle.prototype.overlaps = function (r2) {
        return (this.r >= r2.l &&
            this.l <= r2.r &&
            this.t <= r2.b &&
            this.b >= r2.t);
    };
    return Rectangle;
}());
function assertTrue(assertion, text) {
    if (!assertion) {
        throw new Error("AssertionError: Expected true, got false: " + text);
    }
}
function assertFalse(assertion, text) {
    if (assertion) {
        throw new Error("AssertionError: Expected false, got true: " + text);
    }
}
function assertFallsWithin(p, t) {
    assertTrue(t.rectangle.fallsWithin(p), "falls within? " + p.pos);
}
function assertNotFallsWithin(p, t) {
    assertFalse(t.rectangle.fallsWithin(p), "falls within? " + p.pos);
}
function testQTree() {
    function mp(x, y) {
        return new Particle(x, y);
    }
    var t = new QuadTree(createVector(200, 300), 50, 40);
    assertNotFallsWithin(mp(0, 100), t);
    assertNotFallsWithin(mp(251, 300), t);
    assertNotFallsWithin(mp(149, 300), t);
    assertFallsWithin(mp(176, 281), t);
    assertNotFallsWithin(mp(174, 281), t);
    assertTrue(t.insert(mp(180, 290)), "accept point");
    assertTrue(t.insert(mp(201, 301)), "accept point");
    var r1 = new Rectangle(920, 780, 140, 120);
    var r2 = new Rectangle(918, 720, 100, 140);
    debugger;
    assertTrue(r1.overlaps(r2), "should overlap");
}
function randomScreenPosition() {
    return createVector(random(width), random(height));
}
function centerScreenPos() {
    return createVector(width / 2, height / 2);
}
function randomInt(min, max) {
    return round(random(min, max));
}
function translateToVec(pos) {
    translate(pos.x, pos.y);
}
function maxBy(list, fn) {
    return minBy(list, function (v) { return -fn(v); });
}
function minBy(list, fn) {
    if (list.length < 0) {
        return undefined;
    }
    var recordItem = list[0];
    var recordWeight = fn(list[0]);
    for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {
        var item = list_1[_i];
        var weight = fn(item);
        if (weight < recordWeight) {
            recordWeight = weight;
            recordItem = item;
        }
    }
    return recordItem;
}
function repeat(num, fn) {
    for (var i = 0; i < num; i++) {
        fn(i);
    }
}
function randomBoolean() {
    return Math.random() > 0.5;
}
function mousePosAsVector() {
    return createVector(mouseX, mouseY);
}
function timeIt(fn) {
    var a = millis();
    fn();
    return millis() - a;
}
function showDebugText(x, y, lines) {
    var lineHeight = 40;
    textSize(24);
    var w = textWidth(maxBy(lines, function (l) { return l.length; }));
    fill(100, 100, 100, 200);
    strokeWeight(10);
    stroke("whitesmoke");
    rectMode(CORNER);
    rect(x - 30, y - 30, w + 60, lines.length * lineHeight + 60);
    noStroke();
    fill("black");
    textLeading(lineHeight);
    text(lines.join("\n"), x, y);
}
function drawDebugGrid() {
    noStroke();
    fill("gray");
    textSize(8);
    for (var x = 0; x < width; x += 50) {
        for (var y = 0; y < height; y += 50) {
            text(x + "," + y, x, y);
        }
    }
}
var gPoints;
var gQuadTree;
var gQueryRectangle;
var gQueryResults;
var gTimings = {
    timeToBuild: 0,
    timeToQuery: 0,
    update: 0,
    drawOnly: 0,
    timeToLocateNaively: 0
};
var opts = {
    isGridOn: false,
    isDrawAllPoints: true,
    isDrawQueryResults: true,
    isShowDebugText: true
};
function setup() {
    createCanvas(windowWidth, windowHeight);
    gPoints = [];
}
function mouseDragged() {
    var p = new Particle(mouseX, mouseY);
    gPoints.push(p);
}
function update() {
    gQueryRectangle = new Rectangle(mouseX, mouseY, 100, 100);
    QuadTree.staticQTCounter = 0;
    gTimings.timeToBuild = timeIt(function () {
        gQuadTree = QuadTree.build(width / 2, height / 2, width, height, gPoints);
    });
    gTimings.timeToQuery = timeIt(function () { return (gQueryResults = gQuadTree.query(gQueryRectangle)); });
    gTimings.timeToLocateNaively = timeIt(function () {
        return gPoints.filter(function (p) { return dist(p.pos.x, p.pos.y, mouseX, mouseY) < 100; });
    });
}
function draw() {
    gTimings.update = timeIt(function () { return update(); });
    gTimings.drawOnly = timeIt(function () { return drawOnly(); });
}
function drawOnly() {
    background("black");
    opts.isGridOn && drawDebugGrid();
    drawQuadTree(gQuadTree);
    opts.isDrawAllPoints && drawAllPoints();
    drawQueryRectangle();
    opts.isDrawQueryResults && drawQueryResults();
    opts.isShowDebugText && drawDebugPanels();
}
function drawDebugPanels() {
    showDebugText(50, height - 400, [
        "FPS: " + frameRate().toFixed(2),
        "points from query: " + gQueryResults.length,
        "total points: " + gPoints.length,
        "update() (ms): " + gTimings.update.toFixed(2),
        "drawOnly() (not update) (ms): " + gTimings.drawOnly.toFixed(2),
        "query time (ms): " + gTimings.timeToQuery.toFixed(2),
        "Rebuild time (ms): " + gTimings.timeToBuild.toFixed(0),
        "Naive query (ms):" + gTimings.timeToLocateNaively.toFixed(2)
    ]);
    showDebugText(width / 2, height - 400, [
        "d - toggle Draw of all points",
        "q - toggle draw of Query points",
        "p - (re)Populate *many* points",
        "g - toggle draw of Grid",
        "h - hide/show this Help"
    ]);
}
function drawQueryRectangle() {
    rectMode(CENTER);
    noFill();
    stroke("orange");
    strokeWeight(0.3);
    rect(gQueryRectangle.cx, gQueryRectangle.cy, gQueryRectangle.w, gQueryRectangle.h);
}
function drawAllPoints() {
    stroke("white");
    strokeWeight(2);
    for (var _i = 0, gPoints_1 = gPoints; _i < gPoints_1.length; _i++) {
        var p = gPoints_1[_i];
        point(p.pos.x, p.pos.y);
    }
}
function drawQueryResults() {
    strokeWeight(7);
    stroke("red");
    for (var _i = 0, gQueryResults_1 = gQueryResults; _i < gQueryResults_1.length; _i++) {
        var p = gQueryResults_1[_i];
        point(p.pos.x, p.pos.y);
    }
}
function keyPressed() {
    if (key == "d") {
        toggleDrawAllPoints();
    }
    if (key == "q") {
        toggleDrawQueryResults();
    }
    if (key == "h") {
        toggleShowDebugText();
    }
    if (key == "p") {
        populateTreeRandomly();
    }
    if (key == "g") {
        toggleDrawGrid();
    }
}
function toggleDrawAllPoints() {
    return (opts.isDrawAllPoints = !opts.isDrawAllPoints);
}
function toggleDrawQueryResults() {
    return (opts.isDrawQueryResults = !opts.isDrawQueryResults);
}
function toggleShowDebugText() {
    return (opts.isShowDebugText = !opts.isShowDebugText);
}
function toggleDrawGrid() {
    return (opts.isGridOn = !opts.isGridOn);
}
function populateTreeRandomly() {
    gPoints.length = 0;
    repeat(10000, function (ix) { return gPoints.push(Particle.perlinRandomOnScreen(ix)); });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLi9qcy8iLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiUDVRdWFkVHJlZURyYXcudHMiLCJQYXJ0aWNsZS50cyIsIlF1YWRUcmVlLnRzIiwiUmVjdGFuZ2xlLnRzIiwiVGVzdGluZ1F1YWRUcmVlLnRzIiwiVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FDQ2IsU0FBUyxZQUFZLENBQUMsSUFBYztJQUNsQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDakIsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2xCLE1BQU0sRUFBRSxDQUFDO0lBQ1QsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pCLElBQUksQ0FDRixJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFDakIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQ2pCLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUNoQixJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FDakIsQ0FBQztJQUVGLFFBQVEsRUFBRSxDQUFDO0lBQ1gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2QsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2IsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUV0RCxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUUsRUFBRTtRQUN2QixLQUFvQixVQUFvQyxFQUFwQyxNQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBcEMsY0FBb0MsRUFBcEMsSUFBb0MsRUFBRTtZQUFyRCxJQUFJLE9BQU8sU0FBQTtZQUNkLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUN2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ZUFBZSxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQ3hELENBQUM7QUFFRCxTQUFTLHNCQUFzQjtJQUM3QixPQUFPLENBQUMsSUFBSSxDQUFDLGtCQUFrQixHQUFHLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUM7QUFDOUQsQ0FBQztBQUVELFNBQVMsbUJBQW1CO0lBQzFCLE9BQU8sQ0FBQyxJQUFJLENBQUMsZUFBZSxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQ3hELENBQUM7QUFFRCxTQUFTLGNBQWM7SUFDckIsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDMUMsQ0FBQztBQUVELFNBQVMsb0JBQW9CO0lBQzNCLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ25CLE1BQU0sQ0FBQyxLQUFLLEVBQUUsVUFBQSxFQUFFLElBQUksT0FBQSxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUEvQyxDQUErQyxDQUFDLENBQUM7QUFDdkUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuLy9wNS5kaXNhYmxlRnJpZW5kbHlFcnJvcnMgPSB0cnVlO1xuXG4vL0NyZWRpdHM6IHVzZXMgcG9pbnQtcmVjdGFuZ2xlIGFuZCByZWN0YW5nbGUtcmVjdGFuZ2xlIGNvbGxpc2lvbiBtYXRoIGZyb206XG4vLyBodHRwczovL2dpdGh1Yi5jb20vYm1vcmVuL3A1LmNvbGxpZGUyRC9ibG9iL21hc3Rlci9wNS5jb2xsaWRlMmQuanNcbi8vIGxpY2Vuc2U6IGh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1uYy1zYS80LjAvXG5cbmludGVyZmFjZSBQb2ludCB7XG4gIHBvczogcDUuVmVjdG9yO1xufVxuXG5sZXQgZ1BvaW50czogUGFydGljbGVbXTtcbmxldCBnUXVhZFRyZWU6IFF1YWRUcmVlO1xubGV0IGdRdWVyeVJlY3RhbmdsZTogUmVjdGFuZ2xlO1xubGV0IGdRdWVyeVJlc3VsdHM6IFBvaW50W107XG5cbi8vb25seSBmb3IgcGVyZm9ybWFuY2UgYW5hbHlzaXNcbmxldCBnVGltaW5ncyA9IHtcbiAgdGltZVRvQnVpbGQ6IDAsXG4gIHRpbWVUb1F1ZXJ5OiAwLFxuICB1cGRhdGU6IDAsXG4gIGRyYXdPbmx5OiAwLFxuICB0aW1lVG9Mb2NhdGVOYWl2ZWx5OiAwXG59O1xuXG5pbnRlcmZhY2UgQXBwT3B0aW9ucyB7XG4gIGlzR3JpZE9uOiBib29sZWFuO1xuICBpc0RyYXdBbGxQb2ludHM6IGJvb2xlYW47XG4gIGlzRHJhd1F1ZXJ5UmVzdWx0czogYm9vbGVhbjtcbiAgaXNTaG93RGVidWdUZXh0OiBib29sZWFuO1xufVxuXG5sZXQgb3B0cyA9IHtcbiAgaXNHcmlkT246IGZhbHNlLFxuICBpc0RyYXdBbGxQb2ludHM6IHRydWUsXG4gIGlzRHJhd1F1ZXJ5UmVzdWx0czogdHJ1ZSxcbiAgaXNTaG93RGVidWdUZXh0OiB0cnVlXG59O1xuXG5mdW5jdGlvbiBzZXR1cCgpIHtcbiAgY3JlYXRlQ2FudmFzKHdpbmRvd1dpZHRoLCB3aW5kb3dIZWlnaHQpO1xuICBnUG9pbnRzID0gW107XG59XG5cbmZ1bmN0aW9uIG1vdXNlRHJhZ2dlZCgpIHtcbiAgbGV0IHAgPSBuZXcgUGFydGljbGUobW91c2VYLCBtb3VzZVkpO1xuICBnUG9pbnRzLnB1c2gocCk7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgZ1F1ZXJ5UmVjdGFuZ2xlID0gbmV3IFJlY3RhbmdsZShtb3VzZVgsIG1vdXNlWSwgMTAwLCAxMDApO1xuICBRdWFkVHJlZS5zdGF0aWNRVENvdW50ZXIgPSAwO1xuICBnVGltaW5ncy50aW1lVG9CdWlsZCA9IHRpbWVJdCgoKSA9PiB7XG4gICAgZ1F1YWRUcmVlID0gUXVhZFRyZWUuYnVpbGQod2lkdGggLyAyLCBoZWlnaHQgLyAyLCB3aWR0aCwgaGVpZ2h0LCBnUG9pbnRzKTtcbiAgfSk7XG4gIC8vbWFrZSB0aGUgcXVlcnkgYW5kIGhpZ2hsaWdodCB0aGUgcG9pbnRzIGl0IHJldHVybnNcbiAgZ1RpbWluZ3MudGltZVRvUXVlcnkgPSB0aW1lSXQoXG4gICAgKCkgPT4gKGdRdWVyeVJlc3VsdHMgPSBnUXVhZFRyZWUucXVlcnkoZ1F1ZXJ5UmVjdGFuZ2xlKSlcbiAgKTtcbiAgZ1RpbWluZ3MudGltZVRvTG9jYXRlTmFpdmVseSA9IHRpbWVJdCgoKSA9PlxuICAgIGdQb2ludHMuZmlsdGVyKHAgPT4gZGlzdChwLnBvcy54LCBwLnBvcy55LCBtb3VzZVgsIG1vdXNlWSkgPCAxMDApXG4gICk7XG59XG5cbmZ1bmN0aW9uIGRyYXcoKSB7XG4gIGdUaW1pbmdzLnVwZGF0ZSA9IHRpbWVJdCgoKSA9PiB1cGRhdGUoKSk7XG4gIGdUaW1pbmdzLmRyYXdPbmx5ID0gdGltZUl0KCgpID0+IGRyYXdPbmx5KCkpO1xufVxuZnVuY3Rpb24gZHJhd09ubHkoKSB7XG4gIGJhY2tncm91bmQoXCJibGFja1wiKTtcbiAgb3B0cy5pc0dyaWRPbiAmJiBkcmF3RGVidWdHcmlkKCk7XG4gIGRyYXdRdWFkVHJlZShnUXVhZFRyZWUpO1xuICBvcHRzLmlzRHJhd0FsbFBvaW50cyAmJiBkcmF3QWxsUG9pbnRzKCk7XG4gIGRyYXdRdWVyeVJlY3RhbmdsZSgpO1xuICBvcHRzLmlzRHJhd1F1ZXJ5UmVzdWx0cyAmJiBkcmF3UXVlcnlSZXN1bHRzKCk7XG4gIG9wdHMuaXNTaG93RGVidWdUZXh0ICYmIGRyYXdEZWJ1Z1BhbmVscygpO1xufVxuXG5mdW5jdGlvbiBkcmF3RGVidWdQYW5lbHMoKTogdm9pZCB7XG4gIHNob3dEZWJ1Z1RleHQoNTAsIGhlaWdodCAtIDQwMCwgW1xuICAgIFwiRlBTOiBcIiArIGZyYW1lUmF0ZSgpLnRvRml4ZWQoMiksXG4gICAgXCJwb2ludHMgZnJvbSBxdWVyeTogXCIgKyBnUXVlcnlSZXN1bHRzLmxlbmd0aCxcbiAgICBcInRvdGFsIHBvaW50czogXCIgKyBnUG9pbnRzLmxlbmd0aCxcbiAgICBcInVwZGF0ZSgpIChtcyk6IFwiICsgZ1RpbWluZ3MudXBkYXRlLnRvRml4ZWQoMiksXG4gICAgXCJkcmF3T25seSgpIChub3QgdXBkYXRlKSAobXMpOiBcIiArIGdUaW1pbmdzLmRyYXdPbmx5LnRvRml4ZWQoMiksXG4gICAgXCJxdWVyeSB0aW1lIChtcyk6IFwiICsgZ1RpbWluZ3MudGltZVRvUXVlcnkudG9GaXhlZCgyKSxcbiAgICBcIlJlYnVpbGQgdGltZSAobXMpOiBcIiArIGdUaW1pbmdzLnRpbWVUb0J1aWxkLnRvRml4ZWQoMCksXG4gICAgXCJOYWl2ZSBxdWVyeSAobXMpOlwiICsgZ1RpbWluZ3MudGltZVRvTG9jYXRlTmFpdmVseS50b0ZpeGVkKDIpXG4gIF0pO1xuICBzaG93RGVidWdUZXh0KHdpZHRoIC8gMiwgaGVpZ2h0IC0gNDAwLCBbXG4gICAgXCJkIC0gdG9nZ2xlIERyYXcgb2YgYWxsIHBvaW50c1wiLFxuICAgIFwicSAtIHRvZ2dsZSBkcmF3IG9mIFF1ZXJ5IHBvaW50c1wiLFxuICAgIFwicCAtIChyZSlQb3B1bGF0ZSAqbWFueSogcG9pbnRzXCIsXG4gICAgXCJnIC0gdG9nZ2xlIGRyYXcgb2YgR3JpZFwiLFxuICAgIFwiaCAtIGhpZGUvc2hvdyB0aGlzIEhlbHBcIlxuICBdKTtcbn1cbmZ1bmN0aW9uIGRyYXdRdWVyeVJlY3RhbmdsZSgpOiB2b2lkIHtcbiAgcmVjdE1vZGUoQ0VOVEVSKTtcbiAgbm9GaWxsKCk7XG4gIHN0cm9rZShcIm9yYW5nZVwiKTtcbiAgc3Ryb2tlV2VpZ2h0KDAuMyk7XG4gIHJlY3QoXG4gICAgZ1F1ZXJ5UmVjdGFuZ2xlLmN4LFxuICAgIGdRdWVyeVJlY3RhbmdsZS5jeSxcbiAgICBnUXVlcnlSZWN0YW5nbGUudyxcbiAgICBnUXVlcnlSZWN0YW5nbGUuaFxuICApO1xufVxuZnVuY3Rpb24gZHJhd0FsbFBvaW50cygpOiB2b2lkIHtcbiAgc3Ryb2tlKFwid2hpdGVcIik7XG4gIHN0cm9rZVdlaWdodCgyKTtcblxuICBmb3IgKGxldCBwIG9mIGdQb2ludHMpIHtcbiAgICBwb2ludChwLnBvcy54LCBwLnBvcy55KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBkcmF3UXVlcnlSZXN1bHRzKCk6IHZvaWQge1xuICBzdHJva2VXZWlnaHQoNyk7XG4gIHN0cm9rZShcInJlZFwiKTtcbiAgZm9yIChsZXQgcCBvZiBnUXVlcnlSZXN1bHRzKSB7XG4gICAgcG9pbnQocC5wb3MueCwgcC5wb3MueSk7XG4gIH1cbn1cblxuZnVuY3Rpb24ga2V5UHJlc3NlZCgpIHtcbiAgaWYgKGtleSA9PSBcImRcIikge1xuICAgIHRvZ2dsZURyYXdBbGxQb2ludHMoKTtcbiAgfVxuICBpZiAoa2V5ID09IFwicVwiKSB7XG4gICAgdG9nZ2xlRHJhd1F1ZXJ5UmVzdWx0cygpO1xuICB9XG4gIGlmIChrZXkgPT0gXCJoXCIpIHtcbiAgICB0b2dnbGVTaG93RGVidWdUZXh0KCk7XG4gIH1cbiAgaWYgKGtleSA9PSBcInBcIikge1xuICAgIHBvcHVsYXRlVHJlZVJhbmRvbWx5KCk7XG4gIH1cbiAgaWYgKGtleSA9PSBcImdcIikge1xuICAgIHRvZ2dsZURyYXdHcmlkKCk7XG4gIH1cbn1cbmZ1bmN0aW9uIHRvZ2dsZURyYXdBbGxQb2ludHMoKTogYm9vbGVhbiB7XG4gIHJldHVybiAob3B0cy5pc0RyYXdBbGxQb2ludHMgPSAhb3B0cy5pc0RyYXdBbGxQb2ludHMpO1xufVxuXG5mdW5jdGlvbiB0b2dnbGVEcmF3UXVlcnlSZXN1bHRzKCk6IGJvb2xlYW4ge1xuICByZXR1cm4gKG9wdHMuaXNEcmF3UXVlcnlSZXN1bHRzID0gIW9wdHMuaXNEcmF3UXVlcnlSZXN1bHRzKTtcbn1cblxuZnVuY3Rpb24gdG9nZ2xlU2hvd0RlYnVnVGV4dCgpOiBib29sZWFuIHtcbiAgcmV0dXJuIChvcHRzLmlzU2hvd0RlYnVnVGV4dCA9ICFvcHRzLmlzU2hvd0RlYnVnVGV4dCk7XG59XG5cbmZ1bmN0aW9uIHRvZ2dsZURyYXdHcmlkKCk6IGJvb2xlYW4ge1xuICByZXR1cm4gKG9wdHMuaXNHcmlkT24gPSAhb3B0cy5pc0dyaWRPbik7XG59XG5cbmZ1bmN0aW9uIHBvcHVsYXRlVHJlZVJhbmRvbWx5KCk6IHZvaWQge1xuICBnUG9pbnRzLmxlbmd0aCA9IDA7XG4gIHJlcGVhdCgxMDAwMCwgaXggPT4gZ1BvaW50cy5wdXNoKFBhcnRpY2xlLnBlcmxpblJhbmRvbU9uU2NyZWVuKGl4KSkpO1xufVxuIiwiLy9UT0RPOiB0aGlzIHJlcXVpcmVzIHA1LiAga2VlcCBzZXBhcmF0ZSBmcm9tIGxpYnJhcnktaW5kZXBlbmRlbnQgcXVhZHRyZWUgY29kZVxuZnVuY3Rpb24gZHJhd1F1YWRUcmVlKHRyZWU6IFF1YWRUcmVlKTogdm9pZCB7XG4gIHN0cm9rZShcInllbGxvd1wiKTtcbiAgc3Ryb2tlV2VpZ2h0KDAuMyk7XG4gIG5vRmlsbCgpO1xuICByZWN0TW9kZShDRU5URVIpO1xuICByZWN0KFxuICAgIHRyZWUucmVjdGFuZ2xlLmN4LFxuICAgIHRyZWUucmVjdGFuZ2xlLmN5LFxuICAgIHRyZWUucmVjdGFuZ2xlLncsXG4gICAgdHJlZS5yZWN0YW5nbGUuaFxuICApO1xuXG4gIG5vU3Ryb2tlKCk7XG4gIGZpbGwoXCJ3aGl0ZVwiKTtcbiAgdGV4dFNpemUoMTApO1xuICB0ZXh0KHRyZWUubXlJRCwgdHJlZS5yZWN0YW5nbGUuY3gsIHRyZWUucmVjdGFuZ2xlLmN5KTtcblxuICBpZiAodHJlZS5pc1N1YmRpdmlkZWQoKSkge1xuICAgIGZvciAobGV0IHN1YnRyZWUgb2YgW3RyZWUubmUsIHRyZWUubncsIHRyZWUuc2UsIHRyZWUuc3ddKSB7XG4gICAgICBkcmF3UXVhZFRyZWUoc3VidHJlZSk7XG4gICAgfVxuICB9XG59XG4iLCJjbGFzcyBQYXJ0aWNsZSB7XG4gIHBvczogcDUuVmVjdG9yO1xuICBkcmF3KCk6IHZvaWQge1xuICAgIHN0cm9rZShcIndoaXRlXCIpO1xuICAgIHN0cm9rZVdlaWdodCgxKTtcbiAgICBwb2ludCh0aGlzLnBvcy54LCB0aGlzLnBvcy55KTtcbiAgfVxuICBjb25zdHJ1Y3Rvcih4OiBudW1iZXIsIHk6IG51bWJlcikge1xuICAgIHRoaXMucG9zID0gY3JlYXRlVmVjdG9yKHgsIHkpO1xuICB9XG4gIHN0YXRpYyByYW5kb21PblNjcmVlbigpOiBQYXJ0aWNsZSB7XG4gICAgcmV0dXJuIG5ldyBQYXJ0aWNsZShyYW5kb20od2lkdGgpLCByYW5kb20oaGVpZ2h0KSk7XG4gIH1cbiAgc3RhdGljIHBlcmxpblJhbmRvbU9uU2NyZWVuKGl4OiBudW1iZXIpOiBQYXJ0aWNsZSB7XG4gICAgbGV0IHggPSB3aWR0aCAqIG5vaXNlKGl4ICsgZnJhbWVDb3VudCAvIDEwMCk7XG4gICAgbGV0IHkgPSBoZWlnaHQgKiBub2lzZSg3ICogaXggKyBmcmFtZUNvdW50IC8gMTIzKTtcbiAgICByZXR1cm4gbmV3IFBhcnRpY2xlKHgsIHkpO1xuICB9XG59XG4iLCIvL1RPRE86IHJlbW92ZSBwNS5WZWN0b3IgdG8gaGF2ZSBubyBkZXBlbmRlbmNlIG9uIHA1XG5pbnRlcmZhY2UgSVF1YWRUcmVlIHtcbiAgaW5zZXJ0OiAocDogUG9pbnQpID0+IGJvb2xlYW47XG4gIHF1ZXJ5KHF1ZXJ5UmVjdGFuZ2xlOiBSZWN0YW5nbGUpOiBQb2ludFtdO1xufVxuXG5jbGFzcyBRdWFkVHJlZSBpbXBsZW1lbnRzIElRdWFkVHJlZSB7XG4gIHN0YXRpYyBzdGF0aWNRVENvdW50ZXIgPSAwOyAvL3RoaXMgaXMgYSBoYWNrLiAgdGhpcyBpcyBvbmx5IG5lZWRlZFxuICAvLyB0byBnaXZlIHRoZSBxdWFkdHJlZSBub2RlcyBhbiBpZCBmb3IgZGVidWdnaW5nXG5cbiAgLyoqIEJ1aWxkIGEgUXVhZFRyZWUgd2l0aCB0aGUgZ2l2ZW4gYm91bmRzLCBhbmQgcG9wdWxhdGUgaXQgd2l0aCB0aGUgZ2l2ZW4gcG9pbnRzLlxuICAgKiBSZXR1cm5zIGEgYnVpbHQgcXVhZHRyZWUgKGEgcmVjdXJzaXZlIHN0cnVjdHVyZSkuXG4gICAqL1xuICBzdGF0aWMgYnVpbGQoXG4gICAgY3g6IG51bWJlcixcbiAgICBjeTogbnVtYmVyLFxuICAgIHc6IG51bWJlcixcbiAgICBoOiBudW1iZXIsXG4gICAgZ1BvaW50czogUG9pbnRbXVxuICApOiBRdWFkVHJlZSB7XG4gICAgY29uc3QgdCA9IG5ldyBRdWFkVHJlZShjcmVhdGVWZWN0b3IoY3gsIGN5KSwgdywgaCk7XG4gICAgZ1BvaW50cy5mb3JFYWNoKHAgPT4gdC5pbnNlcnQocCkpO1xuICAgIHJldHVybiB0O1xuICB9XG5cbiAgLyoqIEFkZCB0aGUgZ2l2ZW4gcG9pbnQgdG8gdGhlIHF1YWR0cmVlLlxuICAgKlxuICAgKiBSZXR1cm5zIGZhbHNlIGlmIHRoZSBwb2ludCBpcyBvdXR3aXRoIHRoZSBib3VuZHMgb2YgdGhlIHF1YWR0cmVlLFxuICAgKiBlbHNlIHRydWUuICovXG4gIGluc2VydChwOiBQb2ludCk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5yZWN0YW5nbGUuZmFsbHNXaXRoaW4ocCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy9hY2NlcHQgZGlyZWN0bHksIG9yIGRlbGVnYXRlXG4gICAgaWYgKHRoaXMuZGlyZWN0bHlDb250YWluZWRQb2ludHMubGVuZ3RoIDwgdGhpcy5jYXBhY2l0eSkge1xuICAgICAgdGhpcy5kaXJlY3RseUNvbnRhaW5lZFBvaW50cy5wdXNoKHApO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghdGhpcy5pc1N1YmRpdmlkZWQoKSkge1xuICAgICAgICB0aGlzLnN1YmRpdmlkZSgpO1xuICAgICAgfVxuICAgICAgLy9kZWxlZ2F0ZSB0byBzdWJxdWFkdHJlZXNcbiAgICAgIGlmIChbdGhpcy5uZSwgdGhpcy5udywgdGhpcy5zZSwgdGhpcy5zd10uc29tZShxdCA9PiBxdC5pbnNlcnQocCkpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIFwiU2hvdWxkIGJlIHVucmVhY2hhYmxlLiAgQWxsIHN1YnF1YWRzIHJlamVjdCBwb2ludCBpbnNlcnRpb24uXCJcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqIEZpbmQgYWxsIHBvaW50cyBpbiB0aGUgcXVhZHRyZWUgZmFsbGluZyB3aXRoaW4gdGhlIGdpdmVuIHJlY3RhbmdsZS5cbiAgICpcbiAgICogVGFrZXMgYSBib3VuZGluZyByZWN0YW5nbGUgYXMgbGltaXRzIG9mIHRoZSBxdWVyeVxuICAgKiBSZXR1cm5zIGEgbGlzdCBvZiByZXN1bHRzLlxuICAgKiBJZiBnaXZlbiBhIGxpc3QgdG8gcG9wdWxhdGUgaXQgd2lsbCBhZGQgcmVzdWx0cyB0byB0aGF0IGxpc3QuXG4gICAqL1xuICBxdWVyeShxdWVyeVJlY3RhbmdsZTogUmVjdGFuZ2xlLCByZXN1bHRzPzogUG9pbnRbXSk6IFBvaW50W10ge1xuICAgIGlmIChyZXN1bHRzID09IHVuZGVmaW5lZCkge1xuICAgICAgcmVzdWx0cyA9IFtdO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJlY3RhbmdsZS5vdmVybGFwcyhxdWVyeVJlY3RhbmdsZSkpIHtcbiAgICAgIHJlc3VsdHMucHVzaChcbiAgICAgICAgLi4udGhpcy5kaXJlY3RseUNvbnRhaW5lZFBvaW50cy5maWx0ZXIocCA9PlxuICAgICAgICAgIHF1ZXJ5UmVjdGFuZ2xlLmZhbGxzV2l0aGluKHApXG4gICAgICAgIClcbiAgICAgICk7XG5cbiAgICAgIGlmICh0aGlzLmlzU3ViZGl2aWRlZCgpKSB7XG4gICAgICAgIGZvciAobGV0IHN1YnRyZWUgb2YgW3RoaXMubmUsIHRoaXMubncsIHRoaXMuc2UsIHRoaXMuc3ddKSB7XG4gICAgICAgICAgc3VidHJlZS5xdWVyeShxdWVyeVJlY3RhbmdsZSwgcmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIC8vIGludGVybmFsIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgc3ViZGl2aWRlKCkge1xuICAgIGNvbnN0IGN4ID0gdGhpcy5yZWN0YW5nbGUuY3g7XG4gICAgY29uc3QgY3kgPSB0aGlzLnJlY3RhbmdsZS5jeTtcbiAgICBjb25zdCBxVyA9IHRoaXMucmVjdGFuZ2xlLncgLyA0OyAvL3F1YXJ0ZXIgd2lkdGgsIHF1YXJ0ZXIgaGVpZ2h0XG4gICAgY29uc3QgcUggPSB0aGlzLnJlY3RhbmdsZS5oIC8gNDtcbiAgICBjb25zdCBoVyA9IHFXICogMjsgLy8gaGFsZiB3aWR0aCwgaGFsZiBoZWlnaHRcbiAgICBjb25zdCBoSCA9IHFIICogMjtcblxuICAgIHRoaXMubmUgPSBuZXcgUXVhZFRyZWUoY3JlYXRlVmVjdG9yKGN4ICsgcVcsIGN5IC0gcUgpLCBoVywgaEgpO1xuICAgIHRoaXMubncgPSBuZXcgUXVhZFRyZWUoY3JlYXRlVmVjdG9yKGN4IC0gcVcsIGN5IC0gcUgpLCBoVywgaEgpO1xuICAgIHRoaXMuc2UgPSBuZXcgUXVhZFRyZWUoY3JlYXRlVmVjdG9yKGN4ICsgcVcsIGN5ICsgcUgpLCBoVywgaEgpO1xuICAgIHRoaXMuc3cgPSBuZXcgUXVhZFRyZWUoY3JlYXRlVmVjdG9yKGN4IC0gcVcsIGN5ICsgcUgpLCBoVywgaEgpO1xuICB9XG5cbiAgaXNTdWJkaXZpZGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLm5lICE9PSB1bmRlZmluZWQ7XG4gIH1cblxuICAvLyBtZW1iZXIgdmFyaWFibGVzICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgZGlyZWN0bHlDb250YWluZWRQb2ludHM6IFBvaW50W107XG4gIGNhcGFjaXR5OiBudW1iZXI7XG4gIG5lPzogUXVhZFRyZWU7XG4gIHNlPzogUXVhZFRyZWU7XG4gIG53PzogUXVhZFRyZWU7XG4gIHN3PzogUXVhZFRyZWU7XG5cbiAgcmVjdGFuZ2xlOiBSZWN0YW5nbGU7XG4gIG15SUQ6IG51bWJlcjtcblxuICAvL2NvbnN0cnVjdG9yIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBjb25zdHJ1Y3RvcihjZW50ZXI6IHA1LlZlY3RvciwgdzogbnVtYmVyLCBoOiBudW1iZXIpIHtcbiAgICB0aGlzLm15SUQgPSBRdWFkVHJlZS5zdGF0aWNRVENvdW50ZXIrKztcbiAgICB0aGlzLnJlY3RhbmdsZSA9IG5ldyBSZWN0YW5nbGUoY2VudGVyLngsIGNlbnRlci55LCB3LCBoKTtcbiAgICB0aGlzLmRpcmVjdGx5Q29udGFpbmVkUG9pbnRzID0gW107XG4gICAgdGhpcy5jYXBhY2l0eSA9IDIwO1xuICB9XG59XG4iLCJjbGFzcyBSZWN0YW5nbGUge1xuICBjeDogbnVtYmVyO1xuICBjeTogbnVtYmVyO1xuXG4gIHQ6IG51bWJlcjtcbiAgYjogbnVtYmVyO1xuICBsOiBudW1iZXI7XG4gIHI6IG51bWJlcjtcblxuICB3OiBudW1iZXI7XG4gIGg6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihjeDogbnVtYmVyLCBjeTogbnVtYmVyLCB3OiBudW1iZXIsIGg6IG51bWJlcikge1xuICAgIHRoaXMuY3ggPSBjeDtcbiAgICB0aGlzLmN5ID0gY3k7XG4gICAgdGhpcy53ID0gdztcbiAgICB0aGlzLmggPSBoO1xuICAgIHRoaXMudCA9IHRoaXMuY3kgLSBoIC8gMjtcbiAgICB0aGlzLmIgPSB0aGlzLmN5ICsgaCAvIDI7XG4gICAgdGhpcy5sID0gdGhpcy5jeCAtIHcgLyAyO1xuICAgIHRoaXMuciA9IHRoaXMuY3ggKyB3IC8gMjtcbiAgfVxuXG4gIC8vbW9kaWZpZWQgZnJvbSBjb2xsaWRlUG9pbnRSZWN0O1xuICAvL2h0dHBzOi8vZ2l0aHViLmNvbS9ibW9yZW4vcDUuY29sbGlkZTJEL2Jsb2IvbWFzdGVyL3A1LmNvbGxpZGUyZC5qc1xuICBmYWxsc1dpdGhpbihwOiBQb2ludCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICBwLnBvcy54ID49IHRoaXMubCAmJiAvLyByaWdodCBvZiB0aGUgbGVmdCBlZGdlIEFORFxuICAgICAgcC5wb3MueCA8PSB0aGlzLnIgJiYgLy8gbGVmdCBvZiB0aGUgcmlnaHQgZWRnZSBBTkRcbiAgICAgIHAucG9zLnkgPj0gdGhpcy50ICYmIC8vIGJlbG93IHRoZSB0b3AgQU5EXG4gICAgICBwLnBvcy55IDw9IHRoaXMuYiAvLyBhYm92ZSB0aGUgYm90dG9tXG4gICAgKTtcbiAgfVxuXG4gIC8vbW9kaWZpZWQgZnJvbSBjb2xsaWRlUmVjdFJlY3Q7XG4gIC8vaHR0cHM6Ly9naXRodWIuY29tL2Jtb3Jlbi9wNS5jb2xsaWRlMkQvYmxvYi9tYXN0ZXIvcDUuY29sbGlkZTJkLmpzXG4gIG92ZXJsYXBzKHIyOiBSZWN0YW5nbGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5yID49IHIyLmwgJiYgLy8gbXkgcmlnaHQgaXMgcmlnaHQgb2YgeW91ciBsZWZ0XG4gICAgICB0aGlzLmwgPD0gcjIuciAmJiAvLyBteSBsZWZ0IGlzIGxlZnQgb2YgeW91ciByaWdodFxuICAgICAgdGhpcy50IDw9IHIyLmIgJiYgLy8gbXkgdXBwZXIgaXMgYWJvdmUgeW91ciBsb3dlclxuICAgICAgdGhpcy5iID49IHIyLnQgLy8gbXkgbG93ZXIgaXMgbG93ZXIgdGhhbiB5b3VyIHVwcGVyXG4gICAgKTtcbiAgfVxufVxuIiwiZnVuY3Rpb24gYXNzZXJ0VHJ1ZShhc3NlcnRpb246IGJvb2xlYW4sIHRleHQ6IHN0cmluZyk6IHZvaWQge1xuICBpZiAoIWFzc2VydGlvbikge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkFzc2VydGlvbkVycm9yOiBFeHBlY3RlZCB0cnVlLCBnb3QgZmFsc2U6IFwiICsgdGV4dCk7XG4gIH1cbn1cbmZ1bmN0aW9uIGFzc2VydEZhbHNlKGFzc2VydGlvbjogYm9vbGVhbiwgdGV4dDogc3RyaW5nKTogdm9pZCB7XG4gIGlmIChhc3NlcnRpb24pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJBc3NlcnRpb25FcnJvcjogRXhwZWN0ZWQgZmFsc2UsIGdvdCB0cnVlOiBcIiArIHRleHQpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFzc2VydEZhbGxzV2l0aGluKHA6IFBvaW50LCB0OiBRdWFkVHJlZSkge1xuICBhc3NlcnRUcnVlKHQucmVjdGFuZ2xlLmZhbGxzV2l0aGluKHApLCBgZmFsbHMgd2l0aGluPyAke3AucG9zfWApO1xufVxuZnVuY3Rpb24gYXNzZXJ0Tm90RmFsbHNXaXRoaW4ocDogUG9pbnQsIHQ6IFF1YWRUcmVlKSB7XG4gIGFzc2VydEZhbHNlKHQucmVjdGFuZ2xlLmZhbGxzV2l0aGluKHApLCBgZmFsbHMgd2l0aGluPyAke3AucG9zfWApO1xufVxuXG5mdW5jdGlvbiB0ZXN0UVRyZWUoKTogdm9pZCB7XG4gIGZ1bmN0aW9uIG1wKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgcmV0dXJuIG5ldyBQYXJ0aWNsZSh4LCB5KTtcbiAgfVxuICBjb25zdCB0ID0gbmV3IFF1YWRUcmVlKGNyZWF0ZVZlY3RvcigyMDAsIDMwMCksIDUwLCA0MCk7XG5cbiAgYXNzZXJ0Tm90RmFsbHNXaXRoaW4obXAoMCwgMTAwKSwgdCk7XG5cbiAgYXNzZXJ0Tm90RmFsbHNXaXRoaW4obXAoMjUxLCAzMDApLCB0KTtcbiAgYXNzZXJ0Tm90RmFsbHNXaXRoaW4obXAoMTQ5LCAzMDApLCB0KTtcblxuICBhc3NlcnRGYWxsc1dpdGhpbihtcCgxNzYsIDI4MSksIHQpO1xuICBhc3NlcnROb3RGYWxsc1dpdGhpbihtcCgxNzQsIDI4MSksIHQpO1xuXG4gIGFzc2VydFRydWUodC5pbnNlcnQobXAoMTgwLCAyOTApKSwgXCJhY2NlcHQgcG9pbnRcIik7XG4gIGFzc2VydFRydWUodC5pbnNlcnQobXAoMjAxLCAzMDEpKSwgXCJhY2NlcHQgcG9pbnRcIik7XG5cbiAgbGV0IHIxID0gbmV3IFJlY3RhbmdsZSg5MjAsIDc4MCwgMTQwLCAxMjApO1xuICBsZXQgcjIgPSBuZXcgUmVjdGFuZ2xlKDkxOCwgNzIwLCAxMDAsIDE0MCk7XG4gIGRlYnVnZ2VyO1xuICBhc3NlcnRUcnVlKHIxLm92ZXJsYXBzKHIyKSwgXCJzaG91bGQgb3ZlcmxhcFwiKTtcbn1cbiIsImZ1bmN0aW9uIHJhbmRvbVNjcmVlblBvc2l0aW9uKCk6IHA1LlZlY3RvciB7XG4gIHJldHVybiBjcmVhdGVWZWN0b3IocmFuZG9tKHdpZHRoKSwgcmFuZG9tKGhlaWdodCkpO1xufVxuXG5mdW5jdGlvbiBjZW50ZXJTY3JlZW5Qb3MoKTogcDUuVmVjdG9yIHtcbiAgcmV0dXJuIGNyZWF0ZVZlY3Rvcih3aWR0aCAvIDIsIGhlaWdodCAvIDIpO1xufVxuXG5mdW5jdGlvbiByYW5kb21JbnQobWluOiBudW1iZXIsIG1heDogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIHJvdW5kKHJhbmRvbShtaW4sIG1heCkpO1xufVxuXG5mdW5jdGlvbiB0cmFuc2xhdGVUb1ZlYyhwb3M6IHA1LlZlY3Rvcik6IHZvaWQge1xuICB0cmFuc2xhdGUocG9zLngsIHBvcy55KTtcbn1cbmZ1bmN0aW9uIG1heEJ5PFQ+KGxpc3Q6IFRbXSwgZm46IChpdGVtOiBUKSA9PiBudW1iZXIpOiBUIHtcbiAgcmV0dXJuIG1pbkJ5KGxpc3QsIHYgPT4gLWZuKHYpKTtcbn1cbi8qKiBGaW5kIHRoZSBtaW5pbXVtIG9mIHRoZSBnaXZlbiBsaXN0IGFmdGVyIGFwcGx5aW5nIGZuKCkgdG8gZWFjaC5cbiAqIFJldHVybiB0aGUgbWluaW11bSwgZmlyc3QgbWluaW11bSwgb3IgdW5kZWZpbmVkIGlmIHRoZXJlIGFyZSBubyBpdGVtcy5cbiAqL1xuZnVuY3Rpb24gbWluQnk8VD4obGlzdDogVFtdLCBmbjogKGl0ZW06IFQpID0+IG51bWJlcik6IFQge1xuICBpZiAobGlzdC5sZW5ndGggPCAwKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBsZXQgcmVjb3JkSXRlbSA9IGxpc3RbMF07XG4gIGxldCByZWNvcmRXZWlnaHQgPSBmbihsaXN0WzBdKTtcbiAgZm9yIChsZXQgaXRlbSBvZiBsaXN0KSB7XG4gICAgY29uc3Qgd2VpZ2h0ID0gZm4oaXRlbSk7XG4gICAgaWYgKHdlaWdodCA8IHJlY29yZFdlaWdodCkge1xuICAgICAgcmVjb3JkV2VpZ2h0ID0gd2VpZ2h0O1xuICAgICAgcmVjb3JkSXRlbSA9IGl0ZW07XG4gICAgfVxuICB9XG4gIHJldHVybiByZWNvcmRJdGVtO1xufVxuXG4vKiogUmVwZWF0ZWRseSBjYWxsIHRoZSBnaXZlbiBmdW5jdGlvbiBmbiwgbnVtIHRpbWVzLCB0aHJvd2luZyBhbnkgb3V0cHV0IGF3YXkuICovXG5mdW5jdGlvbiByZXBlYXQobnVtOiBudW1iZXIsIGZuOiAoaXg6IG51bWJlcikgPT4gdm9pZCkge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IG51bTsgaSsrKSB7XG4gICAgZm4oaSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gcmFuZG9tQm9vbGVhbigpOiBib29sZWFuIHtcbiAgcmV0dXJuIE1hdGgucmFuZG9tKCkgPiAwLjU7XG59XG5cbmZ1bmN0aW9uIG1vdXNlUG9zQXNWZWN0b3IoKTogcDUuVmVjdG9yIHtcbiAgcmV0dXJuIGNyZWF0ZVZlY3Rvcihtb3VzZVgsIG1vdXNlWSk7XG59XG5cbmZ1bmN0aW9uIHRpbWVJdChmbjogKCkgPT4gdm9pZCkge1xuICBjb25zdCBhID0gbWlsbGlzKCk7XG4gIGZuKCk7XG4gIHJldHVybiBtaWxsaXMoKSAtIGE7XG59XG5cbi8qKiBTaG93IGEgcGFuZWwgb2YgdGV4dCBpbmZvcm1hdGlvbiwgb24gbXVsdGlwbGUgbGluZXMsIGF0IHRoZSBnaXZlbiBwb3NpdGlvbi5cbiAqXG4gKiBJbnRlbmRlZCBmb3IgZGVidWcgdGV4dC4gKi9cbmZ1bmN0aW9uIHNob3dEZWJ1Z1RleHQoeDogbnVtYmVyLCB5OiBudW1iZXIsIGxpbmVzOiBzdHJpbmdbXSkge1xuICBjb25zdCBsaW5lSGVpZ2h0ID0gNDA7XG4gIHRleHRTaXplKDI0KTtcbiAgY29uc3QgdyA9IHRleHRXaWR0aChtYXhCeShsaW5lcywgbCA9PiBsLmxlbmd0aCkpO1xuXG4gIGZpbGwoMTAwLCAxMDAsIDEwMCwgMjAwKTtcbiAgc3Ryb2tlV2VpZ2h0KDEwKTtcbiAgc3Ryb2tlKFwid2hpdGVzbW9rZVwiKTtcbiAgcmVjdE1vZGUoQ09STkVSKTtcbiAgcmVjdCh4IC0gMzAsIHkgLSAzMCwgdyArIDYwLCBsaW5lcy5sZW5ndGggKiBsaW5lSGVpZ2h0ICsgNjApO1xuXG4gIG5vU3Ryb2tlKCk7XG4gIGZpbGwoXCJibGFja1wiKTtcbiAgdGV4dExlYWRpbmcobGluZUhlaWdodCk7XG4gIHRleHQobGluZXMuam9pbihcIlxcblwiKSwgeCwgeSk7XG59XG5cbmZ1bmN0aW9uIGRyYXdEZWJ1Z0dyaWQoKSB7XG4gIG5vU3Ryb2tlKCk7XG4gIGZpbGwoXCJncmF5XCIpO1xuICB0ZXh0U2l6ZSg4KTtcbiAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgeCArPSA1MCkge1xuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgaGVpZ2h0OyB5ICs9IDUwKSB7XG4gICAgICB0ZXh0KGAke3h9LCR7eX1gLCB4LCB5KTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==