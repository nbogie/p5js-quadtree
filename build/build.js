"use strict";
function drawQuadTree(tree) {
    stroke("yellow");
    strokeWeight(0.3);
    noFill();
    rectMode(CENTER);
    rect(tree.rectangle.cx, tree.rectangle.cy, tree.rectangle.w, tree.rectangle.h);
    noStroke();
    fill("white");
    textSize(10);
    text(tree.myID, tree.rectangle.cx, tree.rectangle.cy);
    if (tree.isSubdivided()) {
        for (var _i = 0, _a = [tree.ne, tree.nw, tree.se, tree.sw]; _i < _a.length; _i++) {
            var subtree = _a[_i];
            drawQuadTree(subtree);
        }
    }
}
var Particle = (function () {
    function Particle(x, y) {
        this.pos = createVector(x, y);
    }
    Particle.prototype.draw = function () {
        stroke("white");
        strokeWeight(1);
        point(this.pos.x, this.pos.y);
    };
    Particle.randomOnScreen = function () {
        return new Particle(random(width), random(height));
    };
    Particle.perlinRandomOnScreen = function (ix) {
        var x = width * noise(ix + frameCount / 100);
        var y = height * noise(7 * ix + frameCount / 123);
        return new Particle(x, y);
    };
    return Particle;
}());
var QuadTree = (function () {
    function QuadTree(center, w, h) {
        this.myID = QuadTree.staticQTCounter++;
        this.rectangle = new Rectangle(center.x, center.y, w, h);
        this.directlyContainedPoints = [];
        this.capacity = 20;
    }
    QuadTree.build = function (cx, cy, w, h, gPoints) {
        var t = new QuadTree(createVector(cx, cy), w, h);
        gPoints.forEach(function (p) { return t.insert(p); });
        return t;
    };
    QuadTree.prototype.insert = function (p) {
        if (!this.rectangle.fallsWithin(p)) {
            return false;
        }
        if (this.directlyContainedPoints.length < this.capacity) {
            this.directlyContainedPoints.push(p);
            return true;
        }
        else {
            if (!this.isSubdivided()) {
                this.subdivide();
            }
            if ([this.ne, this.nw, this.se, this.sw].some(function (qt) { return qt.insert(p); })) {
                return true;
            }
            throw new Error("Should be unreachable.  All subquads reject point insertion.");
        }
    };
    QuadTree.prototype.query = function (queryRectangle, results) {
        if (results == undefined) {
            results = [];
        }
        if (this.rectangle.overlaps(queryRectangle)) {
            results.push.apply(results, this.directlyContainedPoints.filter(function (p) {
                return queryRectangle.fallsWithin(p);
            }));
            if (this.isSubdivided()) {
                for (var _i = 0, _a = [this.ne, this.nw, this.se, this.sw]; _i < _a.length; _i++) {
                    var subtree = _a[_i];
                    subtree.query(queryRectangle, results);
                }
            }
        }
        return results;
    };
    QuadTree.prototype.subdivide = function () {
        var cx = this.rectangle.cx;
        var cy = this.rectangle.cy;
        var qW = this.rectangle.w / 4;
        var qH = this.rectangle.h / 4;
        var hW = qW * 2;
        var hH = qH * 2;
        this.ne = new QuadTree(createVector(cx + qW, cy - qH), hW, hH);
        this.nw = new QuadTree(createVector(cx - qW, cy - qH), hW, hH);
        this.se = new QuadTree(createVector(cx + qW, cy + qH), hW, hH);
        this.sw = new QuadTree(createVector(cx - qW, cy + qH), hW, hH);
    };
    QuadTree.prototype.isSubdivided = function () {
        return this.ne !== undefined;
    };
    QuadTree.staticQTCounter = 0;
    return QuadTree;
}());
var Rectangle = (function () {
    function Rectangle(cx, cy, w, h) {
        this.cx = cx;
        this.cy = cy;
        this.w = w;
        this.h = h;
        this.t = this.cy - h / 2;
        this.b = this.cy + h / 2;
        this.l = this.cx - w / 2;
        this.r = this.cx + w / 2;
    }
    Rectangle.prototype.fallsWithin = function (p) {
        return (p.pos.x >= this.l &&
            p.pos.x <= this.r &&
            p.pos.y >= this.t &&
            p.pos.y <= this.b);
    };
    Rectangle.prototype.overlaps = function (r2) {
        return (this.r >= r2.l &&
            this.l <= r2.r &&
            this.t <= r2.b &&
            this.b >= r2.t);
    };
    return Rectangle;
}());
function assertTrue(assertion, text) {
    if (!assertion) {
        throw new Error("AssertionError: Expected true, got false: " + text);
    }
}
function assertFalse(assertion, text) {
    if (assertion) {
        throw new Error("AssertionError: Expected false, got true: " + text);
    }
}
function assertFallsWithin(p, t) {
    assertTrue(t.fallsWithin(p), "falls within? " + p.pos);
}
function assertNotFallsWithin(p, t) {
    assertFalse(t.fallsWithin(p), "falls within? " + p.pos);
}
function testQTree() {
    function mp(x, y) {
        return new Particle(x, y);
    }
    var t = new QuadTree(createVector(200, 300), 50, 40);
    assertNotFallsWithin(mp(0, 100), t);
    assertNotFallsWithin(mp(251, 300), t);
    assertNotFallsWithin(mp(149, 300), t);
    assertFallsWithin(mp(176, 281), t);
    assertNotFallsWithin(mp(174, 281), t);
    assertTrue(t.insert(mp(180, 290)), "accept point");
    assertTrue(t.insert(mp(201, 301)), "accept point");
    var r1 = new Rectangle(920, 780, 140, 120);
    var r2 = new Rectangle(918, 720, 100, 140);
    debugger;
    assertTrue(r1.overlaps(r2), "should overlap");
}
function randomScreenPosition() {
    return createVector(random(width), random(height));
}
function centerScreenPos() {
    return createVector(width / 2, height / 2);
}
function randomInt(min, max) {
    return round(random(min, max));
}
function translateToVec(pos) {
    translate(pos.x, pos.y);
}
function maxBy(list, fn) {
    return minBy(list, function (v) { return -fn(v); });
}
function minBy(list, fn) {
    if (list.length < 0) {
        return undefined;
    }
    var recordItem = list[0];
    var recordWeight = fn(list[0]);
    for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {
        var item = list_1[_i];
        var weight = fn(item);
        if (weight < recordWeight) {
            recordWeight = weight;
            recordItem = item;
        }
    }
    return recordItem;
}
function repeat(num, fn) {
    for (var i = 0; i < num; i++) {
        fn(i);
    }
}
function randomBoolean() {
    return Math.random() > 0.5;
}
function mousePosAsVector() {
    return createVector(mouseX, mouseY);
}
function timeIt(fn) {
    var a = millis();
    fn();
    return millis() - a;
}
function showDebugText(x, y, lines) {
    var lineHeight = 40;
    textSize(24);
    var w = textWidth(maxBy(lines, function (l) { return l.length; }));
    fill(100, 100, 100, 200);
    strokeWeight(10);
    stroke("whitesmoke");
    rectMode(CORNER);
    rect(x - 30, y - 30, w + 60, lines.length * lineHeight + 60);
    noStroke();
    fill("black");
    textLeading(lineHeight);
    text(lines.join("\n"), x, y);
}
function drawDebugGrid() {
    noStroke();
    fill("gray");
    textSize(8);
    for (var x = 0; x < width; x += 50) {
        for (var y = 0; y < height; y += 50) {
            text(x + "," + y, x, y);
        }
    }
}
var gPoints;
var gQuadTree;
var gQueryRectangle;
var gQueryResults;
var gTimings = {
    timeToBuild: 0,
    timeToQuery: 0,
    update: 0,
    drawOnly: 0,
    timeToLocateNaively: 0
};
var opts = {
    isGridOn: false,
    isDrawAllPoints: true,
    isDrawQueryResults: true,
    isShowDebugText: true
};
function setup() {
    createCanvas(windowWidth, windowHeight);
    gPoints = [];
}
function mouseDragged() {
    var p = new Particle(mouseX, mouseY);
    gPoints.push(p);
}
function update() {
    gQueryRectangle = new Rectangle(mouseX, mouseY, 100, 100);
    QuadTree.staticQTCounter = 0;
    gTimings.timeToBuild = timeIt(function () {
        gQuadTree = QuadTree.build(width / 2, height / 2, width, height, gPoints);
    });
    gTimings.timeToQuery = timeIt(function () { return (gQueryResults = gQuadTree.query(gQueryRectangle)); });
    gTimings.timeToLocateNaively = timeIt(function () {
        return gPoints.filter(function (p) { return dist(p.pos.x, p.pos.y, mouseX, mouseY) < 100; });
    });
}
function draw() {
    gTimings.update = timeIt(function () { return update(); });
    gTimings.drawOnly = timeIt(function () { return drawOnly(); });
}
function drawOnly() {
    background("black");
    opts.isGridOn && drawDebugGrid();
    drawQuadTree(gQuadTree);
    opts.isDrawAllPoints && drawAllPoints();
    drawQueryRectangle();
    opts.isDrawQueryResults && drawQueryResults();
    opts.isShowDebugText && drawDebugPanels();
}
function drawDebugPanels() {
    showDebugText(50, height - 400, [
        "FPS: " + frameRate().toFixed(2),
        "points from query: " + gQueryResults.length,
        "total points: " + gPoints.length,
        "update() (ms): " + gTimings.update.toFixed(2),
        "drawOnly() (not update) (ms): " + gTimings.drawOnly.toFixed(2),
        "query time (ms): " + gTimings.timeToQuery.toFixed(2),
        "Rebuild time (ms): " + gTimings.timeToBuild.toFixed(0),
        "Naive query (ms):" + gTimings.timeToLocateNaively.toFixed(2)
    ]);
    showDebugText(width / 2, height - 400, [
        "d - toggle Draw of all points",
        "q - toggle draw of Query points",
        "p - (re)Populate *many* points",
        "g - toggle draw of Grid",
        "h - hide/show this Help"
    ]);
}
function drawQueryRectangle() {
    rectMode(CENTER);
    noFill();
    stroke("orange");
    strokeWeight(0.3);
    rect(gQueryRectangle.cx, gQueryRectangle.cy, gQueryRectangle.w, gQueryRectangle.h);
}
function drawAllPoints() {
    stroke("white");
    strokeWeight(2);
    for (var _i = 0, gPoints_1 = gPoints; _i < gPoints_1.length; _i++) {
        var p = gPoints_1[_i];
        point(p.pos.x, p.pos.y);
    }
}
function drawQueryResults() {
    strokeWeight(7);
    stroke("red");
    for (var _i = 0, gQueryResults_1 = gQueryResults; _i < gQueryResults_1.length; _i++) {
        var p = gQueryResults_1[_i];
        point(p.pos.x, p.pos.y);
    }
}
function keyPressed() {
    if (key == "d") {
        toggleDrawAllPoints();
    }
    if (key == "q") {
        toggleDrawQueryResults();
    }
    if (key == "h") {
        toggleShowDebugText();
    }
    if (key == "p") {
        populateTreeRandomly();
    }
    if (key == "g") {
        toggleDrawGrid();
    }
}
function toggleDrawAllPoints() {
    return (opts.isDrawAllPoints = !opts.isDrawAllPoints);
}
function toggleDrawQueryResults() {
    return (opts.isDrawQueryResults = !opts.isDrawQueryResults);
}
function toggleShowDebugText() {
    return (opts.isShowDebugText = !opts.isShowDebugText);
}
function toggleDrawGrid() {
    return (opts.isGridOn = !opts.isGridOn);
}
function populateTreeRandomly() {
    gPoints.length = 0;
    repeat(10000, function (ix) { return gPoints.push(Particle.perlinRandomOnScreen(ix)); });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLi9qcy8iLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiUDVRdWFkVHJlZURyYXcudHMiLCJQYXJ0aWNsZS50cyIsIlF1YWRUcmVlLnRzIiwiUmVjdGFuZ2xlLnRzIiwiVGVzdGluZ1F1YWRUcmVlLnRzIiwiVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FDQ2IsU0FBUyxZQUFZLENBQUMsSUFBYztJQUNsQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDakIsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2xCLE1BQU0sRUFBRSxDQUFDO0lBQ1QsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pCLElBQUksQ0FDRixJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFDakIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQ2pCLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUNoQixJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FDakIsQ0FBQztJQUVGLFFBQVEsRUFBRSxDQUFDO0lBQ1gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2QsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2IsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUV0RCxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUUsRUFBRTtRQUN2QixLQUFvQixVQUFvQyxFQUFwQyxNQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBcEMsY0FBb0MsRUFBcEMsSUFBb0MsRUFBRTtZQUFyRCxJQUFJLE9BQU8sU0FBQTtZQUNkLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUN2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Q0FBQyxlQUFlLENBQUMsQ0FBQztBQUN4RCxDQUFDO0FBRUQsU0FBUyxzQkFBc0I7SUFDN0IsT0FBTyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQzlELENBQUM7QUFFRCxTQUFTLG1CQUFtQjtJQUMxQixPQUFPLENBQUMsSUFBSSxDQUFDLGVBQWUsR0FBRyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUN4RCxDQUFDO0FBRUQsU0FBUyxjQUFjO0lBQ3JCLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzFDLENBQUM7QUFFRCxTQUFTLG9CQUFvQjtJQUMzQixPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNuQixNQUFNLENBQUMsS0FBSyxFQUFFLFVBQUEsRUFBRSxJQUFJLE9BQUEsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsb0JBQW9CLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBL0MsQ0FBK0MsQ0FBQyxDQUFDO0FBQ3ZFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbi8vcDUuZGlzYWJsZUZyaWVuZGx5RXJyb3JzID0gdHJ1ZTtcblxuLy9DcmVkaXRzOiB1c2VzIHBvaW50LXJlY3RhbmdsZSBhbmQgcmVjdGFuZ2xlLXJlY3RhbmdsZSBjb2xsaXNpb24gbWF0aCBmcm9tOlxuLy8gaHR0cHM6Ly9naXRodWIuY29tL2Jtb3Jlbi9wNS5jb2xsaWRlMkQvYmxvYi9tYXN0ZXIvcDUuY29sbGlkZTJkLmpzXG4vLyBsaWNlbnNlOiBodHRwczovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktbmMtc2EvNC4wL1xuXG5pbnRlcmZhY2UgUG9pbnQge1xuICBwb3M6IHA1LlZlY3Rvcjtcbn1cblxubGV0IGdQb2ludHM6IFBhcnRpY2xlW107XG5sZXQgZ1F1YWRUcmVlOiBRdWFkVHJlZTtcbmxldCBnUXVlcnlSZWN0YW5nbGU6IFJlY3RhbmdsZTtcbmxldCBnUXVlcnlSZXN1bHRzOiBQb2ludFtdO1xuXG4vL29ubHkgZm9yIHBlcmZvcm1hbmNlIGFuYWx5c2lzXG5sZXQgZ1RpbWluZ3MgPSB7XG4gIHRpbWVUb0J1aWxkOiAwLFxuICB0aW1lVG9RdWVyeTogMCxcbiAgdXBkYXRlOiAwLFxuICBkcmF3T25seTogMCxcbiAgdGltZVRvTG9jYXRlTmFpdmVseTogMFxufTtcblxuaW50ZXJmYWNlIEFwcE9wdGlvbnMge1xuICBpc0dyaWRPbjogYm9vbGVhbjtcbiAgaXNEcmF3QWxsUG9pbnRzOiBib29sZWFuO1xuICBpc0RyYXdRdWVyeVJlc3VsdHM6IGJvb2xlYW47XG4gIGlzU2hvd0RlYnVnVGV4dDogYm9vbGVhbjtcbn1cblxubGV0IG9wdHMgPSB7XG4gIGlzR3JpZE9uOiBmYWxzZSxcbiAgaXNEcmF3QWxsUG9pbnRzOiB0cnVlLFxuICBpc0RyYXdRdWVyeVJlc3VsdHM6IHRydWUsXG4gIGlzU2hvd0RlYnVnVGV4dDogdHJ1ZVxufTtcblxuZnVuY3Rpb24gc2V0dXAoKSB7XG4gIGNyZWF0ZUNhbnZhcyh3aW5kb3dXaWR0aCwgd2luZG93SGVpZ2h0KTtcbiAgZ1BvaW50cyA9IFtdO1xufVxuXG5mdW5jdGlvbiBtb3VzZURyYWdnZWQoKSB7XG4gIGxldCBwID0gbmV3IFBhcnRpY2xlKG1vdXNlWCwgbW91c2VZKTtcbiAgZ1BvaW50cy5wdXNoKHApO1xufVxuXG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gIGdRdWVyeVJlY3RhbmdsZSA9IG5ldyBSZWN0YW5nbGUobW91c2VYLCBtb3VzZVksIDEwMCwgMTAwKTtcbiAgUXVhZFRyZWUuc3RhdGljUVRDb3VudGVyID0gMDtcbiAgZ1RpbWluZ3MudGltZVRvQnVpbGQgPSB0aW1lSXQoKCkgPT4ge1xuICAgIGdRdWFkVHJlZSA9IFF1YWRUcmVlLmJ1aWxkKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgd2lkdGgsIGhlaWdodCwgZ1BvaW50cyk7XG4gIH0pO1xuICAvL21ha2UgdGhlIHF1ZXJ5IGFuZCBoaWdobGlnaHQgdGhlIHBvaW50cyBpdCByZXR1cm5zXG4gIGdUaW1pbmdzLnRpbWVUb1F1ZXJ5ID0gdGltZUl0KFxuICAgICgpID0+IChnUXVlcnlSZXN1bHRzID0gZ1F1YWRUcmVlLnF1ZXJ5KGdRdWVyeVJlY3RhbmdsZSkpXG4gICk7XG4gIGdUaW1pbmdzLnRpbWVUb0xvY2F0ZU5haXZlbHkgPSB0aW1lSXQoKCkgPT5cbiAgICBnUG9pbnRzLmZpbHRlcihwID0+IGRpc3QocC5wb3MueCwgcC5wb3MueSwgbW91c2VYLCBtb3VzZVkpIDwgMTAwKVxuICApO1xufVxuXG5mdW5jdGlvbiBkcmF3KCkge1xuICBnVGltaW5ncy51cGRhdGUgPSB0aW1lSXQoKCkgPT4gdXBkYXRlKCkpO1xuICBnVGltaW5ncy5kcmF3T25seSA9IHRpbWVJdCgoKSA9PiBkcmF3T25seSgpKTtcbn1cbmZ1bmN0aW9uIGRyYXdPbmx5KCkge1xuICBiYWNrZ3JvdW5kKFwiYmxhY2tcIik7XG4gIG9wdHMuaXNHcmlkT24gJiYgZHJhd0RlYnVnR3JpZCgpO1xuICBkcmF3UXVhZFRyZWUoZ1F1YWRUcmVlKTtcbiAgb3B0cy5pc0RyYXdBbGxQb2ludHMgJiYgZHJhd0FsbFBvaW50cygpO1xuICBkcmF3UXVlcnlSZWN0YW5nbGUoKTtcbiAgb3B0cy5pc0RyYXdRdWVyeVJlc3VsdHMgJiYgZHJhd1F1ZXJ5UmVzdWx0cygpO1xuICBvcHRzLmlzU2hvd0RlYnVnVGV4dCAmJiBkcmF3RGVidWdQYW5lbHMoKTtcbn1cblxuZnVuY3Rpb24gZHJhd0RlYnVnUGFuZWxzKCk6IHZvaWQge1xuICBzaG93RGVidWdUZXh0KDUwLCBoZWlnaHQgLSA0MDAsIFtcbiAgICBcIkZQUzogXCIgKyBmcmFtZVJhdGUoKS50b0ZpeGVkKDIpLFxuICAgIFwicG9pbnRzIGZyb20gcXVlcnk6IFwiICsgZ1F1ZXJ5UmVzdWx0cy5sZW5ndGgsXG4gICAgXCJ0b3RhbCBwb2ludHM6IFwiICsgZ1BvaW50cy5sZW5ndGgsXG4gICAgXCJ1cGRhdGUoKSAobXMpOiBcIiArIGdUaW1pbmdzLnVwZGF0ZS50b0ZpeGVkKDIpLFxuICAgIFwiZHJhd09ubHkoKSAobm90IHVwZGF0ZSkgKG1zKTogXCIgKyBnVGltaW5ncy5kcmF3T25seS50b0ZpeGVkKDIpLFxuICAgIFwicXVlcnkgdGltZSAobXMpOiBcIiArIGdUaW1pbmdzLnRpbWVUb1F1ZXJ5LnRvRml4ZWQoMiksXG4gICAgXCJSZWJ1aWxkIHRpbWUgKG1zKTogXCIgKyBnVGltaW5ncy50aW1lVG9CdWlsZC50b0ZpeGVkKDApLFxuICAgIFwiTmFpdmUgcXVlcnkgKG1zKTpcIiArIGdUaW1pbmdzLnRpbWVUb0xvY2F0ZU5haXZlbHkudG9GaXhlZCgyKVxuICBdKTtcbiAgc2hvd0RlYnVnVGV4dCh3aWR0aCAvIDIsIGhlaWdodCAtIDQwMCwgW1xuICAgIFwiZCAtIHRvZ2dsZSBEcmF3IG9mIGFsbCBwb2ludHNcIixcbiAgICBcInEgLSB0b2dnbGUgZHJhdyBvZiBRdWVyeSBwb2ludHNcIixcbiAgICBcInAgLSAocmUpUG9wdWxhdGUgKm1hbnkqIHBvaW50c1wiLFxuICAgIFwiZyAtIHRvZ2dsZSBkcmF3IG9mIEdyaWRcIixcbiAgICBcImggLSBoaWRlL3Nob3cgdGhpcyBIZWxwXCJcbiAgXSk7XG59XG5mdW5jdGlvbiBkcmF3UXVlcnlSZWN0YW5nbGUoKTogdm9pZCB7XG4gIHJlY3RNb2RlKENFTlRFUik7XG4gIG5vRmlsbCgpO1xuICBzdHJva2UoXCJvcmFuZ2VcIik7XG4gIHN0cm9rZVdlaWdodCgwLjMpO1xuICByZWN0KFxuICAgIGdRdWVyeVJlY3RhbmdsZS5jeCxcbiAgICBnUXVlcnlSZWN0YW5nbGUuY3ksXG4gICAgZ1F1ZXJ5UmVjdGFuZ2xlLncsXG4gICAgZ1F1ZXJ5UmVjdGFuZ2xlLmhcbiAgKTtcbn1cbmZ1bmN0aW9uIGRyYXdBbGxQb2ludHMoKTogdm9pZCB7XG4gIHN0cm9rZShcIndoaXRlXCIpO1xuICBzdHJva2VXZWlnaHQoMik7XG5cbiAgZm9yIChsZXQgcCBvZiBnUG9pbnRzKSB7XG4gICAgcG9pbnQocC5wb3MueCwgcC5wb3MueSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZHJhd1F1ZXJ5UmVzdWx0cygpOiB2b2lkIHtcbiAgc3Ryb2tlV2VpZ2h0KDcpO1xuICBzdHJva2UoXCJyZWRcIik7XG4gIGZvciAobGV0IHAgb2YgZ1F1ZXJ5UmVzdWx0cykge1xuICAgIHBvaW50KHAucG9zLngsIHAucG9zLnkpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGtleVByZXNzZWQoKSB7XG4gIGlmIChrZXkgPT0gXCJkXCIpIHtcbiAgICB0b2dnbGVEcmF3QWxsUG9pbnRzKCk7XG4gIH1cbiAgaWYgKGtleSA9PSBcInFcIikge1xuICAgIHRvZ2dsZURyYXdRdWVyeVJlc3VsdHMoKTtcbiAgfVxuICBpZiAoa2V5ID09IFwiaFwiKSB7XG4gICAgdG9nZ2xlU2hvd0RlYnVnVGV4dCgpO1xuICB9XG4gIGlmIChrZXkgPT0gXCJwXCIpIHtcbiAgICBwb3B1bGF0ZVRyZWVSYW5kb21seSgpO1xuICB9XG4gIGlmIChrZXkgPT0gXCJnXCIpIHtcbiAgICB0b2dnbGVEcmF3R3JpZCgpO1xuICB9XG59XG5mdW5jdGlvbiB0b2dnbGVEcmF3QWxsUG9pbnRzKCk6IGJvb2xlYW4ge1xuICByZXR1cm4gKG9wdHMuaXNEcmF3QWxsUG9pbnRzID0gIW9wdHMuaXNEcmF3QWxsUG9pbnRzKTtcbn1cblxuZnVuY3Rpb24gdG9nZ2xlRHJhd1F1ZXJ5UmVzdWx0cygpOiBib29sZWFuIHtcbiAgcmV0dXJuIChvcHRzLmlzRHJhd1F1ZXJ5UmVzdWx0cyA9ICFvcHRzLmlzRHJhd1F1ZXJ5UmVzdWx0cyk7XG59XG5cbmZ1bmN0aW9uIHRvZ2dsZVNob3dEZWJ1Z1RleHQoKTogYm9vbGVhbiB7XG4gIHJldHVybiAob3B0cy5pc1Nob3dEZWJ1Z1RleHQgPSAhb3B0cy5pc1Nob3dEZWJ1Z1RleHQpO1xufVxuXG5mdW5jdGlvbiB0b2dnbGVEcmF3R3JpZCgpOiBib29sZWFuIHtcbiAgcmV0dXJuIChvcHRzLmlzR3JpZE9uID0gIW9wdHMuaXNHcmlkT24pO1xufVxuXG5mdW5jdGlvbiBwb3B1bGF0ZVRyZWVSYW5kb21seSgpOiB2b2lkIHtcbiAgZ1BvaW50cy5sZW5ndGggPSAwO1xuICByZXBlYXQoMTAwMDAsIGl4ID0+IGdQb2ludHMucHVzaChQYXJ0aWNsZS5wZXJsaW5SYW5kb21PblNjcmVlbihpeCkpKTtcbn1cbiIsIi8vVE9ETzogdGhpcyByZXF1aXJlcyBwNS4gIGtlZXAgc2VwYXJhdGUgZnJvbSBsaWJyYXJ5LWluZGVwZW5kZW50IHF1YWR0cmVlIGNvZGVcbmZ1bmN0aW9uIGRyYXdRdWFkVHJlZSh0cmVlOiBRdWFkVHJlZSk6IHZvaWQge1xuICBzdHJva2UoXCJ5ZWxsb3dcIik7XG4gIHN0cm9rZVdlaWdodCgwLjMpO1xuICBub0ZpbGwoKTtcbiAgcmVjdE1vZGUoQ0VOVEVSKTtcbiAgcmVjdChcbiAgICB0cmVlLnJlY3RhbmdsZS5jeCxcbiAgICB0cmVlLnJlY3RhbmdsZS5jeSxcbiAgICB0cmVlLnJlY3RhbmdsZS53LFxuICAgIHRyZWUucmVjdGFuZ2xlLmhcbiAgKTtcblxuICBub1N0cm9rZSgpO1xuICBmaWxsKFwid2hpdGVcIik7XG4gIHRleHRTaXplKDEwKTtcbiAgdGV4dCh0cmVlLm15SUQsIHRyZWUucmVjdGFuZ2xlLmN4LCB0cmVlLnJlY3RhbmdsZS5jeSk7XG5cbiAgaWYgKHRyZWUuaXNTdWJkaXZpZGVkKCkpIHtcbiAgICBmb3IgKGxldCBzdWJ0cmVlIG9mIFt0cmVlLm5lLCB0cmVlLm53LCB0cmVlLnNlLCB0cmVlLnN3XSkge1xuICAgICAgZHJhd1F1YWRUcmVlKHN1YnRyZWUpO1xuICAgIH1cbiAgfVxufVxuIiwiY2xhc3MgUGFydGljbGUge1xuICBwb3M6IHA1LlZlY3RvcjtcbiAgZHJhdygpOiB2b2lkIHtcbiAgICBzdHJva2UoXCJ3aGl0ZVwiKTtcbiAgICBzdHJva2VXZWlnaHQoMSk7XG4gICAgcG9pbnQodGhpcy5wb3MueCwgdGhpcy5wb3MueSk7XG4gIH1cbiAgY29uc3RydWN0b3IoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICB0aGlzLnBvcyA9IGNyZWF0ZVZlY3Rvcih4LCB5KTtcbiAgfVxuICBzdGF0aWMgcmFuZG9tT25TY3JlZW4oKTogUGFydGljbGUge1xuICAgIHJldHVybiBuZXcgUGFydGljbGUocmFuZG9tKHdpZHRoKSwgcmFuZG9tKGhlaWdodCkpO1xuICB9XG4gIHN0YXRpYyBwZXJsaW5SYW5kb21PblNjcmVlbihpeDogbnVtYmVyKTogUGFydGljbGUge1xuICAgIGxldCB4ID0gd2lkdGggKiBub2lzZShpeCArIGZyYW1lQ291bnQgLyAxMDApO1xuICAgIGxldCB5ID0gaGVpZ2h0ICogbm9pc2UoNyAqIGl4ICsgZnJhbWVDb3VudCAvIDEyMyk7XG4gICAgcmV0dXJuIG5ldyBQYXJ0aWNsZSh4LCB5KTtcbiAgfVxufVxuIiwiLy9UT0RPOiByZW1vdmUgcDUuVmVjdG9yIHRvIGhhdmUgbm8gZGVwZW5kZW5jZSBvbiBwNVxuaW50ZXJmYWNlIElRdWFkVHJlZSB7XG4gIGluc2VydDogKHA6IFBvaW50KSA9PiBib29sZWFuO1xuICBxdWVyeShxdWVyeVJlY3RhbmdsZTogUmVjdGFuZ2xlKTogUG9pbnRbXTtcbn1cblxuY2xhc3MgUXVhZFRyZWUgaW1wbGVtZW50cyBJUXVhZFRyZWUge1xuICBzdGF0aWMgc3RhdGljUVRDb3VudGVyID0gMDsgLy90aGlzIGlzIGEgaGFjay4gIHRoaXMgaXMgb25seSBuZWVkZWRcbiAgLy8gdG8gZ2l2ZSB0aGUgcXVhZHRyZWUgbm9kZXMgYW4gaWQgZm9yIGRlYnVnZ2luZ1xuXG4gIC8qKiBCdWlsZCBhIFF1YWRUcmVlIHdpdGggdGhlIGdpdmVuIGJvdW5kcywgYW5kIHBvcHVsYXRlIGl0IHdpdGggdGhlIGdpdmVuIHBvaW50cy5cbiAgICogUmV0dXJucyBhIGJ1aWx0IHF1YWR0cmVlIChhIHJlY3Vyc2l2ZSBzdHJ1Y3R1cmUpLlxuICAgKi9cbiAgc3RhdGljIGJ1aWxkKFxuICAgIGN4OiBudW1iZXIsXG4gICAgY3k6IG51bWJlcixcbiAgICB3OiBudW1iZXIsXG4gICAgaDogbnVtYmVyLFxuICAgIGdQb2ludHM6IFBvaW50W11cbiAgKTogUXVhZFRyZWUge1xuICAgIGNvbnN0IHQgPSBuZXcgUXVhZFRyZWUoY3JlYXRlVmVjdG9yKGN4LCBjeSksIHcsIGgpO1xuICAgIGdQb2ludHMuZm9yRWFjaChwID0+IHQuaW5zZXJ0KHApKTtcbiAgICByZXR1cm4gdDtcbiAgfVxuXG4gIC8qKiBBZGQgdGhlIGdpdmVuIHBvaW50IHRvIHRoZSBxdWFkdHJlZS5cbiAgICpcbiAgICogUmV0dXJucyBmYWxzZSBpZiB0aGUgcG9pbnQgaXMgb3V0d2l0aCB0aGUgYm91bmRzIG9mIHRoZSBxdWFkdHJlZSxcbiAgICogZWxzZSB0cnVlLiAqL1xuICBpbnNlcnQocDogUG9pbnQpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMucmVjdGFuZ2xlLmZhbGxzV2l0aGluKHApKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vYWNjZXB0IGRpcmVjdGx5LCBvciBkZWxlZ2F0ZVxuICAgIGlmICh0aGlzLmRpcmVjdGx5Q29udGFpbmVkUG9pbnRzLmxlbmd0aCA8IHRoaXMuY2FwYWNpdHkpIHtcbiAgICAgIHRoaXMuZGlyZWN0bHlDb250YWluZWRQb2ludHMucHVzaChwKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIXRoaXMuaXNTdWJkaXZpZGVkKCkpIHtcbiAgICAgICAgdGhpcy5zdWJkaXZpZGUoKTtcbiAgICAgIH1cbiAgICAgIC8vZGVsZWdhdGUgdG8gc3VicXVhZHRyZWVzXG4gICAgICBpZiAoW3RoaXMubmUsIHRoaXMubncsIHRoaXMuc2UsIHRoaXMuc3ddLnNvbWUocXQgPT4gcXQuaW5zZXJ0KHApKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIlNob3VsZCBiZSB1bnJlYWNoYWJsZS4gIEFsbCBzdWJxdWFkcyByZWplY3QgcG9pbnQgaW5zZXJ0aW9uLlwiXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBGaW5kIGFsbCBwb2ludHMgaW4gdGhlIHF1YWR0cmVlIGZhbGxpbmcgd2l0aGluIHRoZSBnaXZlbiByZWN0YW5nbGUuXG4gICAqXG4gICAqIFRha2VzIGEgYm91bmRpbmcgcmVjdGFuZ2xlIGFzIGxpbWl0cyBvZiB0aGUgcXVlcnlcbiAgICogUmV0dXJucyBhIGxpc3Qgb2YgcmVzdWx0cy5cbiAgICogSWYgZ2l2ZW4gYSBsaXN0IHRvIHBvcHVsYXRlIGl0IHdpbGwgYWRkIHJlc3VsdHMgdG8gdGhhdCBsaXN0LlxuICAgKi9cbiAgcXVlcnkocXVlcnlSZWN0YW5nbGU6IFJlY3RhbmdsZSwgcmVzdWx0cz86IFBvaW50W10pOiBQb2ludFtdIHtcbiAgICBpZiAocmVzdWx0cyA9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJlc3VsdHMgPSBbXTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5yZWN0YW5nbGUub3ZlcmxhcHMocXVlcnlSZWN0YW5nbGUpKSB7XG4gICAgICByZXN1bHRzLnB1c2goXG4gICAgICAgIC4uLnRoaXMuZGlyZWN0bHlDb250YWluZWRQb2ludHMuZmlsdGVyKHAgPT5cbiAgICAgICAgICBxdWVyeVJlY3RhbmdsZS5mYWxsc1dpdGhpbihwKVxuICAgICAgICApXG4gICAgICApO1xuXG4gICAgICBpZiAodGhpcy5pc1N1YmRpdmlkZWQoKSkge1xuICAgICAgICBmb3IgKGxldCBzdWJ0cmVlIG9mIFt0aGlzLm5lLCB0aGlzLm53LCB0aGlzLnNlLCB0aGlzLnN3XSkge1xuICAgICAgICAgIHN1YnRyZWUucXVlcnkocXVlcnlSZWN0YW5nbGUsIHJlc3VsdHMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICAvLyBpbnRlcm5hbCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIHN1YmRpdmlkZSgpIHtcbiAgICBjb25zdCBjeCA9IHRoaXMucmVjdGFuZ2xlLmN4O1xuICAgIGNvbnN0IGN5ID0gdGhpcy5yZWN0YW5nbGUuY3k7XG4gICAgY29uc3QgcVcgPSB0aGlzLnJlY3RhbmdsZS53IC8gNDsgLy9xdWFydGVyIHdpZHRoLCBxdWFydGVyIGhlaWdodFxuICAgIGNvbnN0IHFIID0gdGhpcy5yZWN0YW5nbGUuaCAvIDQ7XG4gICAgY29uc3QgaFcgPSBxVyAqIDI7IC8vIGhhbGYgd2lkdGgsIGhhbGYgaGVpZ2h0XG4gICAgY29uc3QgaEggPSBxSCAqIDI7XG5cbiAgICB0aGlzLm5lID0gbmV3IFF1YWRUcmVlKGNyZWF0ZVZlY3RvcihjeCArIHFXLCBjeSAtIHFIKSwgaFcsIGhIKTtcbiAgICB0aGlzLm53ID0gbmV3IFF1YWRUcmVlKGNyZWF0ZVZlY3RvcihjeCAtIHFXLCBjeSAtIHFIKSwgaFcsIGhIKTtcbiAgICB0aGlzLnNlID0gbmV3IFF1YWRUcmVlKGNyZWF0ZVZlY3RvcihjeCArIHFXLCBjeSArIHFIKSwgaFcsIGhIKTtcbiAgICB0aGlzLnN3ID0gbmV3IFF1YWRUcmVlKGNyZWF0ZVZlY3RvcihjeCAtIHFXLCBjeSArIHFIKSwgaFcsIGhIKTtcbiAgfVxuXG4gIGlzU3ViZGl2aWRlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5uZSAhPT0gdW5kZWZpbmVkO1xuICB9XG5cbiAgLy8gbWVtYmVyIHZhcmlhYmxlcyAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGRpcmVjdGx5Q29udGFpbmVkUG9pbnRzOiBQb2ludFtdO1xuICBjYXBhY2l0eTogbnVtYmVyO1xuICBuZT86IFF1YWRUcmVlO1xuICBzZT86IFF1YWRUcmVlO1xuICBudz86IFF1YWRUcmVlO1xuICBzdz86IFF1YWRUcmVlO1xuXG4gIHJlY3RhbmdsZTogUmVjdGFuZ2xlO1xuICBteUlEOiBudW1iZXI7XG5cbiAgLy9jb25zdHJ1Y3RvciAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgY29uc3RydWN0b3IoY2VudGVyOiBwNS5WZWN0b3IsIHc6IG51bWJlciwgaDogbnVtYmVyKSB7XG4gICAgdGhpcy5teUlEID0gUXVhZFRyZWUuc3RhdGljUVRDb3VudGVyKys7XG4gICAgdGhpcy5yZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKGNlbnRlci54LCBjZW50ZXIueSwgdywgaCk7XG4gICAgdGhpcy5kaXJlY3RseUNvbnRhaW5lZFBvaW50cyA9IFtdO1xuICAgIHRoaXMuY2FwYWNpdHkgPSAyMDtcbiAgfVxufVxuIiwiY2xhc3MgUmVjdGFuZ2xlIHtcbiAgY3g6IG51bWJlcjtcbiAgY3k6IG51bWJlcjtcblxuICB0OiBudW1iZXI7XG4gIGI6IG51bWJlcjtcbiAgbDogbnVtYmVyO1xuICByOiBudW1iZXI7XG5cbiAgdzogbnVtYmVyO1xuICBoOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoY3g6IG51bWJlciwgY3k6IG51bWJlciwgdzogbnVtYmVyLCBoOiBudW1iZXIpIHtcbiAgICB0aGlzLmN4ID0gY3g7XG4gICAgdGhpcy5jeSA9IGN5O1xuICAgIHRoaXMudyA9IHc7XG4gICAgdGhpcy5oID0gaDtcbiAgICB0aGlzLnQgPSB0aGlzLmN5IC0gaCAvIDI7XG4gICAgdGhpcy5iID0gdGhpcy5jeSArIGggLyAyO1xuICAgIHRoaXMubCA9IHRoaXMuY3ggLSB3IC8gMjtcbiAgICB0aGlzLnIgPSB0aGlzLmN4ICsgdyAvIDI7XG4gIH1cblxuICAvL21vZGlmaWVkIGZyb20gY29sbGlkZVBvaW50UmVjdDtcbiAgLy9odHRwczovL2dpdGh1Yi5jb20vYm1vcmVuL3A1LmNvbGxpZGUyRC9ibG9iL21hc3Rlci9wNS5jb2xsaWRlMmQuanNcbiAgZmFsbHNXaXRoaW4ocDogUG9pbnQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgcC5wb3MueCA+PSB0aGlzLmwgJiYgLy8gcmlnaHQgb2YgdGhlIGxlZnQgZWRnZSBBTkRcbiAgICAgIHAucG9zLnggPD0gdGhpcy5yICYmIC8vIGxlZnQgb2YgdGhlIHJpZ2h0IGVkZ2UgQU5EXG4gICAgICBwLnBvcy55ID49IHRoaXMudCAmJiAvLyBiZWxvdyB0aGUgdG9wIEFORFxuICAgICAgcC5wb3MueSA8PSB0aGlzLmIgLy8gYWJvdmUgdGhlIGJvdHRvbVxuICAgICk7XG4gIH1cblxuICAvL21vZGlmaWVkIGZyb20gY29sbGlkZVJlY3RSZWN0O1xuICAvL2h0dHBzOi8vZ2l0aHViLmNvbS9ibW9yZW4vcDUuY29sbGlkZTJEL2Jsb2IvbWFzdGVyL3A1LmNvbGxpZGUyZC5qc1xuICBvdmVybGFwcyhyMjogUmVjdGFuZ2xlKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuciA+PSByMi5sICYmIC8vIG15IHJpZ2h0IGlzIHJpZ2h0IG9mIHlvdXIgbGVmdFxuICAgICAgdGhpcy5sIDw9IHIyLnIgJiYgLy8gbXkgbGVmdCBpcyBsZWZ0IG9mIHlvdXIgcmlnaHRcbiAgICAgIHRoaXMudCA8PSByMi5iICYmIC8vIG15IHVwcGVyIGlzIGFib3ZlIHlvdXIgbG93ZXJcbiAgICAgIHRoaXMuYiA+PSByMi50IC8vIG15IGxvd2VyIGlzIGxvd2VyIHRoYW4geW91ciB1cHBlclxuICAgICk7XG4gIH1cbn1cbiIsImZ1bmN0aW9uIGFzc2VydFRydWUoYXNzZXJ0aW9uOiBib29sZWFuLCB0ZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgaWYgKCFhc3NlcnRpb24pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJBc3NlcnRpb25FcnJvcjogRXhwZWN0ZWQgdHJ1ZSwgZ290IGZhbHNlOiBcIiArIHRleHQpO1xuICB9XG59XG5mdW5jdGlvbiBhc3NlcnRGYWxzZShhc3NlcnRpb246IGJvb2xlYW4sIHRleHQ6IHN0cmluZyk6IHZvaWQge1xuICBpZiAoYXNzZXJ0aW9uKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQXNzZXJ0aW9uRXJyb3I6IEV4cGVjdGVkIGZhbHNlLCBnb3QgdHJ1ZTogXCIgKyB0ZXh0KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhc3NlcnRGYWxsc1dpdGhpbihwOiBQb2ludCwgdDogUXVhZFRyZWUpIHtcbiAgYXNzZXJ0VHJ1ZSh0LmZhbGxzV2l0aGluKHApLCBgZmFsbHMgd2l0aGluPyAke3AucG9zfWApO1xufVxuZnVuY3Rpb24gYXNzZXJ0Tm90RmFsbHNXaXRoaW4ocDogUG9pbnQsIHQ6IFF1YWRUcmVlKSB7XG4gIGFzc2VydEZhbHNlKHQuZmFsbHNXaXRoaW4ocCksIGBmYWxscyB3aXRoaW4/ICR7cC5wb3N9YCk7XG59XG5cbmZ1bmN0aW9uIHRlc3RRVHJlZSgpOiB2b2lkIHtcbiAgZnVuY3Rpb24gbXAoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICByZXR1cm4gbmV3IFBhcnRpY2xlKHgsIHkpO1xuICB9XG4gIGNvbnN0IHQgPSBuZXcgUXVhZFRyZWUoY3JlYXRlVmVjdG9yKDIwMCwgMzAwKSwgNTAsIDQwKTtcblxuICBhc3NlcnROb3RGYWxsc1dpdGhpbihtcCgwLCAxMDApLCB0KTtcblxuICBhc3NlcnROb3RGYWxsc1dpdGhpbihtcCgyNTEsIDMwMCksIHQpO1xuICBhc3NlcnROb3RGYWxsc1dpdGhpbihtcCgxNDksIDMwMCksIHQpO1xuXG4gIGFzc2VydEZhbGxzV2l0aGluKG1wKDE3NiwgMjgxKSwgdCk7XG4gIGFzc2VydE5vdEZhbGxzV2l0aGluKG1wKDE3NCwgMjgxKSwgdCk7XG5cbiAgYXNzZXJ0VHJ1ZSh0Lmluc2VydChtcCgxODAsIDI5MCkpLCBcImFjY2VwdCBwb2ludFwiKTtcbiAgYXNzZXJ0VHJ1ZSh0Lmluc2VydChtcCgyMDEsIDMwMSkpLCBcImFjY2VwdCBwb2ludFwiKTtcblxuICBsZXQgcjEgPSBuZXcgUmVjdGFuZ2xlKDkyMCwgNzgwLCAxNDAsIDEyMCk7XG4gIGxldCByMiA9IG5ldyBSZWN0YW5nbGUoOTE4LCA3MjAsIDEwMCwgMTQwKTtcbiAgZGVidWdnZXI7XG4gIGFzc2VydFRydWUocjEub3ZlcmxhcHMocjIpLCBcInNob3VsZCBvdmVybGFwXCIpO1xufVxuIiwiZnVuY3Rpb24gcmFuZG9tU2NyZWVuUG9zaXRpb24oKTogcDUuVmVjdG9yIHtcbiAgcmV0dXJuIGNyZWF0ZVZlY3RvcihyYW5kb20od2lkdGgpLCByYW5kb20oaGVpZ2h0KSk7XG59XG5cbmZ1bmN0aW9uIGNlbnRlclNjcmVlblBvcygpOiBwNS5WZWN0b3Ige1xuICByZXR1cm4gY3JlYXRlVmVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7XG59XG5cbmZ1bmN0aW9uIHJhbmRvbUludChtaW46IG51bWJlciwgbWF4OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gcm91bmQocmFuZG9tKG1pbiwgbWF4KSk7XG59XG5cbmZ1bmN0aW9uIHRyYW5zbGF0ZVRvVmVjKHBvczogcDUuVmVjdG9yKTogdm9pZCB7XG4gIHRyYW5zbGF0ZShwb3MueCwgcG9zLnkpO1xufVxuZnVuY3Rpb24gbWF4Qnk8VD4obGlzdDogVFtdLCBmbjogKGl0ZW06IFQpID0+IG51bWJlcik6IFQge1xuICByZXR1cm4gbWluQnkobGlzdCwgdiA9PiAtZm4odikpO1xufVxuLyoqIEZpbmQgdGhlIG1pbmltdW0gb2YgdGhlIGdpdmVuIGxpc3QgYWZ0ZXIgYXBwbHlpbmcgZm4oKSB0byBlYWNoLlxuICogUmV0dXJuIHRoZSBtaW5pbXVtLCBmaXJzdCBtaW5pbXVtLCBvciB1bmRlZmluZWQgaWYgdGhlcmUgYXJlIG5vIGl0ZW1zLlxuICovXG5mdW5jdGlvbiBtaW5CeTxUPihsaXN0OiBUW10sIGZuOiAoaXRlbTogVCkgPT4gbnVtYmVyKTogVCB7XG4gIGlmIChsaXN0Lmxlbmd0aCA8IDApIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG4gIGxldCByZWNvcmRJdGVtID0gbGlzdFswXTtcbiAgbGV0IHJlY29yZFdlaWdodCA9IGZuKGxpc3RbMF0pO1xuICBmb3IgKGxldCBpdGVtIG9mIGxpc3QpIHtcbiAgICBjb25zdCB3ZWlnaHQgPSBmbihpdGVtKTtcbiAgICBpZiAod2VpZ2h0IDwgcmVjb3JkV2VpZ2h0KSB7XG4gICAgICByZWNvcmRXZWlnaHQgPSB3ZWlnaHQ7XG4gICAgICByZWNvcmRJdGVtID0gaXRlbTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlY29yZEl0ZW07XG59XG5cbi8qKiBSZXBlYXRlZGx5IGNhbGwgdGhlIGdpdmVuIGZ1bmN0aW9uIGZuLCBudW0gdGltZXMsIHRocm93aW5nIGFueSBvdXRwdXQgYXdheS4gKi9cbmZ1bmN0aW9uIHJlcGVhdChudW06IG51bWJlciwgZm46IChpeDogbnVtYmVyKSA9PiB2b2lkKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtOyBpKyspIHtcbiAgICBmbihpKTtcbiAgfVxufVxuXG5mdW5jdGlvbiByYW5kb21Cb29sZWFuKCk6IGJvb2xlYW4ge1xuICByZXR1cm4gTWF0aC5yYW5kb20oKSA+IDAuNTtcbn1cblxuZnVuY3Rpb24gbW91c2VQb3NBc1ZlY3RvcigpOiBwNS5WZWN0b3Ige1xuICByZXR1cm4gY3JlYXRlVmVjdG9yKG1vdXNlWCwgbW91c2VZKTtcbn1cblxuZnVuY3Rpb24gdGltZUl0KGZuOiAoKSA9PiB2b2lkKSB7XG4gIGNvbnN0IGEgPSBtaWxsaXMoKTtcbiAgZm4oKTtcbiAgcmV0dXJuIG1pbGxpcygpIC0gYTtcbn1cblxuLyoqIFNob3cgYSBwYW5lbCBvZiB0ZXh0IGluZm9ybWF0aW9uLCBvbiBtdWx0aXBsZSBsaW5lcywgYXQgdGhlIGdpdmVuIHBvc2l0aW9uLlxuICpcbiAqIEludGVuZGVkIGZvciBkZWJ1ZyB0ZXh0LiAqL1xuZnVuY3Rpb24gc2hvd0RlYnVnVGV4dCh4OiBudW1iZXIsIHk6IG51bWJlciwgbGluZXM6IHN0cmluZ1tdKSB7XG4gIGNvbnN0IGxpbmVIZWlnaHQgPSA0MDtcbiAgdGV4dFNpemUoMjQpO1xuICBjb25zdCB3ID0gdGV4dFdpZHRoKG1heEJ5KGxpbmVzLCBsID0+IGwubGVuZ3RoKSk7XG5cbiAgZmlsbCgxMDAsIDEwMCwgMTAwLCAyMDApO1xuICBzdHJva2VXZWlnaHQoMTApO1xuICBzdHJva2UoXCJ3aGl0ZXNtb2tlXCIpO1xuICByZWN0TW9kZShDT1JORVIpO1xuICByZWN0KHggLSAzMCwgeSAtIDMwLCB3ICsgNjAsIGxpbmVzLmxlbmd0aCAqIGxpbmVIZWlnaHQgKyA2MCk7XG5cbiAgbm9TdHJva2UoKTtcbiAgZmlsbChcImJsYWNrXCIpO1xuICB0ZXh0TGVhZGluZyhsaW5lSGVpZ2h0KTtcbiAgdGV4dChsaW5lcy5qb2luKFwiXFxuXCIpLCB4LCB5KTtcbn1cblxuZnVuY3Rpb24gZHJhd0RlYnVnR3JpZCgpIHtcbiAgbm9TdHJva2UoKTtcbiAgZmlsbChcImdyYXlcIik7XG4gIHRleHRTaXplKDgpO1xuICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyB4ICs9IDUwKSB7XG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7IHkgKz0gNTApIHtcbiAgICAgIHRleHQoYCR7eH0sJHt5fWAsIHgsIHkpO1xuICAgIH1cbiAgfVxufVxuIl19